<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Financial Calculators | Enterprise Room Business Hub</title>
    <link rel="icon" type="image/jpeg" href="assets/logo.jpg">
    <script>
        // Check authentication before page loads
        (function() {
            if (sessionStorage.getItem('userAuthenticated') !== 'true') {
                sessionStorage.setItem('redirectAfterLogin', 'tools.html');
                window.location.replace('login.html');
                return;
            }
        })();
    </script>
    <link rel="stylesheet" href="css/styles.css">
    <style>
        /* Page-specific styles */
        .tools-page-container {
            display: flex;
            gap: 30px;
            max-width: 100%;
            width: 100%;
            margin: 0 auto;
            padding: 40px 5%;
            min-height: calc(100vh - 200px);
            box-sizing: border-box;
        }

        /* Sidebar Menu */
        .tools-sidebar {
            width: 280px;
            background: #f5fbff;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
            border: 1px solid #d0e8ff;
            height: fit-content;
            position: sticky;
            top: 100px;
            flex-shrink: 0;
        }

        .tools-sidebar h2 {
            margin-top: 0;
            margin-bottom: 20px;
            font-size: 1.3rem;
            color: var(--primary);
            border-bottom: 2px solid var(--light);
            padding-bottom: 10px;
        }

        .tools-menu {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .tools-menu li {
            margin-bottom: 8px;
        }

        .tools-menu a {
            display: block;
            padding: 12px 15px;
            color: var(--text);
            text-decoration: none;
            border-radius: 8px;
            transition: all 0.3s;
            font-weight: 500;
            border-left: 3px solid transparent;
        }

        .tools-menu a:hover {
            background: #e6f2ff;
            color: var(--accent);
            border-left-color: var(--accent);
        }

        .tools-menu a.active {
            background: var(--accent);
            color: var(--white);
            border-left-color: var(--primary);
        }

        /* Main Content Area */
        .tools-content {
            flex: 1;
            min-width: 0;
            width: 100%;
            max-width: none;
        }

        .tool-view {
            display: none;
            background: #f5fbff;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
            border: 1px solid #d0e8ff;
            width: 100%;
            max-width: 100%;
            box-sizing: border-box;
        }

        .tool-view.active {
            display: block;
            animation: fadeIn 0.3s ease-in;
        }

        .tool-view h2 {
            margin-top: 0;
            margin-bottom: 10px;
            font-size: 2rem;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .tool-view .tool-description {
            color: var(--text-light);
            margin-bottom: 25px;
            font-size: 1rem;
        }

        .tool-form {
            width: 100%;
            max-width: 100%;
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        .tool-form .input-group {
            margin-bottom: 20px;
        }

        .tool-form label {
            font-size: 0.95rem;
            font-weight: 600;
            margin-bottom: 8px;
            display: block;
        }

        .tool-form input,
        .tool-form select {
            width: 100%;
            padding: 12px;
            font-size: 1rem;
            border: 1px solid var(--border);
            border-radius: 8px;
            background: var(--white);
        }

        .tool-form .input-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .btn-calc {
            width: 100%;
            max-width: 300px;
            padding: 14px 30px;
            background: var(--primary);
            color: var(--white);
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            font-size: 1rem;
            margin-top: 10px;
            transition: background 0.2s;
        }

        .btn-calc:hover {
            background: var(--accent);
        }

        .result-box {
            margin-top: 30px;
            padding: 25px;
            background: #ebf8ff;
            border-radius: 12px;
            border: 1px solid #bee3f8;
            display: none;
        }

        .result-box.show {
            display: block;
        }

        .result-header {
            text-align: center;
            margin-bottom: 20px;
        }

        .result-label {
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text);
            margin-bottom: 8px;
        }

        .result-val {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 15px;
        }

        .result-conversion {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px dashed #cbd5e0;
        }

        .currency-item {
            font-weight: 600;
            color: var(--text);
            font-size: 1.1rem;
        }

        .result-details {
            margin-top: 25px;
            padding-top: 25px;
            border-top: 1px solid var(--border);
        }

        .result-details-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #e2e8f0;
            font-size: 0.95rem;
        }

        .result-details-row:last-child {
            border-bottom: none;
        }

        .result-details-row strong {
            color: var(--text);
        }

        .result-details-row span {
            color: var(--primary);
            font-weight: 600;
        }

        .info-icon {
            position: relative;
            display: inline-block;
            cursor: help;
            margin-left: 8px;
        }

        .info-icon .tooltip {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            margin-bottom: 10px;
            padding: 15px 20px;
            background: var(--text);
            color: var(--white);
            border-radius: 10px;
            font-size: 1.05rem;
            white-space: normal;
            width: 450px;
            max-width: 90vw;
            text-align: left;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
            z-index: 10000;
            line-height: 1.7;
            box-shadow: 0 6px 20px rgba(0,0,0,0.4);
            word-wrap: break-word;
            overflow-wrap: break-word;
        }

        /* Ensure tooltip stays within viewport */
        .info-icon .tooltip::before {
            content: '';
            position: absolute;
            bottom: -8px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 8px solid transparent;
            border-right: 8px solid transparent;
            border-top: 8px solid var(--text);
        }

        /* Adjust tooltip position if near top of viewport */
        .info-icon {
            position: relative;
        }

        /* For tooltips that might go off-screen, show below instead */
        @media (min-width: 1024px) {
            .info-icon .tooltip {
                max-width: 500px;
            }
        }

        .info-icon:hover .tooltip {
            opacity: 1;
        }

        /* Special styling for CIT tooltip with longer content */
        #tool-cit .info-icon .tooltip {
            width: 500px;
            max-width: 95vw;
            font-size: 1.1rem;
            padding: 18px 22px;
            line-height: 1.8;
        }

        /* Adjust tooltip position for h2 titles to prevent top clipping */
        .tool-view h2 .info-icon .tooltip {
            bottom: auto;
            top: calc(100% + 10px);
            margin-bottom: 0;
            margin-top: 0;
        }

        .tool-view h2 .info-icon .tooltip::before {
            bottom: auto;
            top: -8px;
            border-top: none;
            border-bottom: 8px solid var(--text);
        }

        .budget-result-box {
            background-color: #f0fff4;
            border-color: #c6f6d5;
        }

        .budget-result-val {
            color: var(--success);
        }

        /* Mobile Menu Toggle */
        .mobile-menu-toggle {
            display: none;
            background: var(--primary);
            color: var(--white);
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.2rem;
            margin-bottom: 20px;
        }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .tools-page-container {
                flex-direction: column;
            }

            .tools-sidebar {
                width: 100%;
                position: relative;
                top: 0;
            }

            .mobile-menu-toggle {
                display: block;
            }

            .tools-sidebar {
                display: none;
            }

            .tools-sidebar.show {
                display: block;
            }
        }

        @media (max-width: 768px) {
            .tools-page-container {
                padding: 20px;
            }

            .tool-view {
                padding: 20px;
            }

            .tool-form .input-grid {
                grid-template-columns: 1fr;
            }

            .result-val {
                font-size: 2rem;
            }
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>
<body>

<nav>
    <a href="index.html" class="logo">
        <img src="assets/logo.jpg" alt="Enterprise Room Business Hub Logo" style="height: 60px; max-width: 200px; width: auto; object-fit: contain;">
        <span>Enterprise Room Business Hub</span>
    </a>
    <ul>
        <li><a href="index.html">Home</a></li>
        <li><a href="eventspage.html">Events</a></li>
        <li><a href="blog.html">Blog</a></li>
        <li><a href="tools.html">Tools</a></li>
        <li><a href="templates.html">Templates</a></li>
        <li><a href="pitch.html" class="btn-primary-link">Pitch Competition</a></li>
        <li><a href="directories.html" class="btn-primary-link">Directories</a></li>
        <li><a href="profile.html" class="btn-profile"><span class="nav-avatar-text">My Profile</span></a></li>
    </ul>
</nav>

<div class="breadcrumbs">
    <a href="index.html">Home</a>
    <span>/</span>
    <span>Financial Calculators</span>
</div>

<div class="tools-page-container">
    <!-- Sidebar Menu -->
    <aside class="tools-sidebar" id="toolsSidebar">
        <h2>Financial Tools</h2>
        <ul class="tools-menu">
            <li><a href="#" onclick="console.log('Clicked savings'); showTool('savings'); return false;" class="active" data-tool="savings">Savings Target Calculator</a></li>
            <li><a href="#" onclick="showTool('loan'); return false;" data-tool="loan">Business Loan Calculator</a></li>
            <li><a href="#" onclick="showTool('mortgage'); return false;" data-tool="mortgage">Mortgage Calculator</a></li>
            <li><a href="#" onclick="showTool('pit'); return false;" data-tool="pit">PIT Calculator (Nigeria)</a></li>
            <li><a href="#" onclick="showTool('cit'); return false;" data-tool="cit">CIT Calculator (Nigeria)</a></li>
            <li><a href="#" onclick="showTool('breakeven'); return false;" data-tool="breakeven">Break-Even Calculator</a></li>
            <li><a href="#" onclick="showTool('cashflow'); return false;" data-tool="cashflow">Cash Flow Forecast</a></li>
            <li><a href="#" onclick="showTool('profitmargin'); return false;" data-tool="profitmargin">Profit Margin Calculator</a></li>
            <li><a href="#" onclick="showTool('payroll'); return false;" data-tool="payroll">Payroll Calculator (Nigeria)</a></li>
            <li><a href="#" onclick="showTool('roi'); return false;" data-tool="roi">ROI Calculator</a></li>
        </ul>
    </aside>

    <!-- Main Content Area -->
    <main class="tools-content">
        <button class="mobile-menu-toggle" onclick="toggleSidebar()">☰ Menu</button>

        <!-- Savings Target Calculator -->
        <div class="tool-view active" id="tool-savings">
            <h2>
                Savings Target Calculator
                <span class="info-icon">
                    <span style="color: var(--accent); font-size: 1.2rem;">ℹ️</span>
                    <span class="tooltip">Calculate how much you need to save monthly to reach your financial target by a specific date.</span>
                </span>
            </h2>
            <p class="tool-description">Plan your savings strategy by calculating the monthly amount needed to reach your target goal.</p>
            
            <div class="tool-form">
                <div class="input-group">
                    <label>Target Type</label>
                    <select id="targetType" style="width: 100%; padding: 12px; font-size: 1rem; border: 1px solid var(--border); border-radius: 8px; background: var(--white);">
                        <option value="event">Event Amount Target</option>
                        <option value="savings">Savings Amount Target</option>
                        <option value="school">School Fees Amount Target</option>
                        <option value="holiday">Holiday Amount Target</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>Target Amount (₦)</label>
                    <input type="text" id="targetAmount" value="500,000.00" onblur="formatAmountInput(this)" onfocus="this.value = this.value.replace(/,/g, '')" placeholder="Enter target amount">
                </div>
                <div class="input-group">
                    <label>
                        Target Month/Year
                        <span class="info-icon">
                            <span style="color: var(--accent); font-size: 1rem;">ℹ️</span>
                            <span class="tooltip">Select the month and year when you want to meet your target</span>
                        </span>
                    </label>
                    <input type="month" id="dueDate" style="width: 100%; padding: 12px; font-size: 1rem; border: 1px solid var(--border); border-radius: 8px;">
                </div>
                <button class="btn-calc" onclick="calculateSavingsTarget()">Calculate Monthly Budget</button>
                
                <div class="result-box budget-result-box" id="savingsResultBox">
                    <div class="result-header">
                        <div class="result-label">Monthly Savings Required</div>
                        <div class="result-val budget-result-val" id="savingsResult">₦0.00</div>
                        <div class="result-conversion">
                            <span class="currency-item" id="savingsUSD">$0.00</span>
                            <span class="currency-item" id="savingsGBP">£0.00</span>
                        </div>
                    </div>
                    <div class="result-details">
                        <div class="result-details-row">
                            <strong>Total Budget:</strong>
                            <span id="totalBudgetDisplay">₦0.00</span>
                        </div>
                        <div class="result-details-row">
                            <strong>Due Date:</strong>
                            <span id="dueDateDisplay">-</span>
                        </div>
                        <div class="result-details-row">
                            <strong><span id="monthsRemaining">0</span> <span id="paymentText">payment</span> of:</strong>
                            <span id="monthlyTargetDisplay" style="color: var(--primary); font-weight: bold;">₦0.00</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Business Loan Calculator -->
        <div class="tool-view" id="tool-loan">
            <h2>Business Loan Calculator</h2>
            <p class="tool-description">Calculate your monthly loan repayment amount based on loan amount, interest rate, and term.</p>
            
            <div class="tool-form">
                <div class="input-group">
                    <label>Loan Amount (₦)</label>
                    <input type="text" id="loanAmount" value="5,000,000.00" onblur="formatAmountInput(this)" onfocus="this.value = this.value.replace(/,/g, '')">
                </div>
                <div class="input-grid">
                    <div class="input-group">
                        <label>Interest Rate (Annual %)</label>
                        <input type="number" id="loanRate" value="22" step="0.1">
                    </div>
                    <div class="input-group">
                        <label>Term (Months)</label>
                        <input type="number" id="loanTerm" value="24">
                    </div>
                </div>
                <button class="btn-calc" onclick="calculateLoan()">Calculate Repayment</button>
                
                <div class="result-box" id="loanResultBox">
                    <div class="result-header">
                        <div class="result-label">Monthly Repayment</div>
                        <div class="result-val" id="loanResult">₦0.00</div>
                        <div class="result-conversion">
                            <span class="currency-item" id="loanUSD">$0.00</span>
                            <span class="currency-item" id="loanGBP">£0.00</span>
                        </div>
                    </div>
                    <div class="result-details">
                        <div class="result-details-row">
                            <strong>Loan Amount:</strong>
                            <span id="loanAmountDisplay">₦0.00</span>
                        </div>
                        <div class="result-details-row">
                            <strong>Interest Rate:</strong>
                            <span id="loanRateDisplay">0%</span>
                        </div>
                        <div class="result-details-row">
                            <strong>Loan Term:</strong>
                            <span id="loanTermDisplay">0 months</span>
                        </div>
                        <div class="result-details-row">
                            <strong>Total Interest:</strong>
                            <span id="loanTotalInterest">₦0.00</span>
                        </div>
                        <div class="result-details-row">
                            <strong>Total Amount Payable:</strong>
                            <span id="loanTotalPayable" style="color: var(--primary); font-weight: bold;">₦0.00</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Mortgage Calculator -->
        <div class="tool-view" id="tool-mortgage">
            <h2>Mortgage Calculator</h2>
            <p class="tool-description">Calculate your estimated monthly mortgage payment for property purchases.</p>
            
            <div class="tool-form">
                <div class="input-group">
                    <label>Property Price (₦)</label>
                    <input type="text" id="propPrice" value="45,000,000.00" onblur="formatAmountInput(this); updateLoanAmount();" onfocus="this.value = this.value.replace(/,/g, '')">
                </div>
                <div class="input-grid">
                    <div class="input-group">
                        <label>Deposit (₦)</label>
                        <input type="text" id="downPayment" value="9,000,000.00" onblur="formatAmountInput(this); updateLoanAmount();" onfocus="this.value = this.value.replace(/,/g, '')">
                    </div>
                    <div class="input-group">
                        <label>Loan Amount (₦)</label>
                        <input type="text" id="loanAmountMortgage" value="36,000,000.00" readonly style="background-color: #f5f5f5; cursor: not-allowed;" onblur="formatAmountInput(this)">
                    </div>
                </div>
                <div class="input-grid">
                    <div class="input-group">
                        <label>Interest Rate (%)</label>
                        <input type="number" id="mortgageRate" value="16">
                    </div>
                    <div class="input-group">
                        <label>Term (Years)</label>
                        <input type="number" id="mortgageTerm" value="15">
                    </div>
                </div>
                <button class="btn-calc" onclick="calculateMortgage()">Calculate Mortgage</button>
                
                <div class="result-box" id="mortgageResultBox">
                    <div class="result-header">
                        <div class="result-label">Estimated Monthly Payment</div>
                        <div class="result-val" id="mortgageResult">₦0.00</div>
                        <div class="result-conversion">
                            <span class="currency-item" id="mortgageUSD">$0.00</span>
                            <span class="currency-item" id="mortgageGBP">£0.00</span>
                        </div>
                    </div>
                    <div class="result-details">
                        <div class="result-details-row">
                            <strong>Property Price:</strong>
                            <span id="mortgagePropertyPrice">₦0.00</span>
                        </div>
                        <div class="result-details-row">
                            <strong>Loan Amount:</strong>
                            <span id="mortgageLoanAmount">₦0.00</span>
                        </div>
                        <div class="result-details-row">
                            <strong>Down Payment:</strong>
                            <span id="mortgageDownPayment">₦0.00</span>
                        </div>
                        <div class="result-details-row">
                            <strong>Interest Rate:</strong>
                            <span id="mortgageRateDisplay">0%</span>
                        </div>
                        <div class="result-details-row">
                            <strong>Loan Term:</strong>
                            <span id="mortgageTermDisplay">0 years</span>
                        </div>
                        <div class="result-details-row">
                            <strong>Total Interest:</strong>
                            <span id="mortgageTotalInterest">₦0.00</span>
                        </div>
                        <div class="result-details-row">
                            <strong>Total Amount Payable:</strong>
                            <span id="mortgageTotalPayable" style="color: var(--primary); font-weight: bold;">₦0.00</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- PIT Calculator -->
        <div class="tool-view" id="tool-pit">
            <h2>
                PIT Calculator (Nigeria)
                <span class="info-icon">
                    <span style="color: var(--accent); font-size: 1.2rem;">ℹ️</span>
                    <span class="tooltip">PIT stands for Personal Income Tax. Calculate your personal income tax based on Nigeria's 2026 tax brackets.</span>
                </span>
            </h2>
            <p class="tool-description">Calculate your personal income tax liability based on Nigeria's 2026 tax law with progressive brackets and allowable deductions.</p>
            
            <div class="tool-form">
                <div class="input-group">
                    <label>Annual Gross Salary (₦)</label>
                    <input type="text" id="annualSalary" value="5,000,000.00" onblur="formatAmountInput(this)" onfocus="this.value = this.value.replace(/,/g, '')" placeholder="Enter your annual salary">
                </div>
                <div class="input-grid">
                    <div class="input-group">
                        <label style="display: flex; align-items: center; gap: 5px;">
                            <span>Annual Rent (₦)</span>
                            <span class="info-icon">
                                <span style="color: var(--accent); font-size: 1rem;">ℹ️</span>
                                <span class="tooltip">The amount you can claim for rent relief is up to but not more than ₦500,000.00</span>
                            </span>
                        </label>
                        <input type="text" id="annualRent" value="0.00" onblur="formatAmountInput(this)" onfocus="this.value = this.value.replace(/,/g, '')" placeholder="Enter annual rent">
                    </div>
                    <div class="input-group">
                        <label style="display: flex; align-items: center; gap: 5px;">
                            <span>Life Insurance (₦)</span>
                            <span class="info-icon">
                                <span style="color: var(--accent); font-size: 1rem;">ℹ️</span>
                                <span class="tooltip">The amount you can claim for life insurance is up to but not more than ₦100,000.00</span>
                            </span>
                        </label>
                        <input type="text" id="lifeInsurance" value="0.00" onblur="formatAmountInput(this)" onfocus="this.value = this.value.replace(/,/g, '')" placeholder="Enter insurance premiums">
                    </div>
                </div>
                <div class="input-group">
                    <label>NHIS Contribution (₦) <small style="color: var(--text-light);">(Optional)</small></label>
                    <input type="text" id="nhisContribution" value="0.00" onblur="formatAmountInput(this)" onfocus="this.value = this.value.replace(/,/g, '')" placeholder="Enter NHIS contribution">
                </div>
                <button class="btn-calc" onclick="calculatePersonalIncomeTax()">Calculate Tax</button>
                
                <div class="result-box" id="taxResultBox">
                    <div class="result-header">
                        <div class="result-label">Annual Tax Payable</div>
                        <div class="result-val" id="taxResult">₦0.00</div>
                        <div class="result-conversion">
                            <span class="currency-item" id="taxUSD">$0.00</span>
                            <span class="currency-item" id="taxGBP">£0.00</span>
                        </div>
                    </div>
                    <div class="result-details">
                        <div class="result-details-row">
                            <strong>Monthly Tax:</strong>
                            <span id="monthlyTax">₦0.00</span>
                        </div>
                        <div class="result-details-row">
                            <strong>Taxable Income:</strong>
                            <span id="taxableIncome">₦0.00</span>
                        </div>
                        <div class="result-details-row">
                            <strong>Total Deductions:</strong>
                            <span id="totalDeductions">₦0.00</span>
                        </div>
                        <div class="result-details-row">
                            <strong>Net Income After Tax:</strong>
                            <span id="netIncome" style="color: var(--success); font-weight: bold;">₦0.00</span>
                        </div>
                        <div class="result-details-row">
                            <strong>Effective Tax Rate:</strong>
                            <span id="effectiveTaxRate">0%</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- CIT Calculator -->
        <div class="tool-view" id="tool-cit">
            <h2>
                CIT Calculator (Nigeria)
                <span class="info-icon">
                    <span style="color: var(--accent); font-size: 1.2rem;">ℹ️</span>
                    <span class="tooltip">CIT stands for Company Income Tax. Calculate your company's income tax based on Nigeria's 2026 tax law. Small companies (turnover ≤ ₦100M and assets ≤ ₦250M, excluding professional services) are exempt. Other companies pay 30% on taxable profit. Large companies (turnover ≥ ₦20B) have a minimum 15% effective tax rate.</span>
                </span>
            </h2>
            <p class="tool-description">Calculate your company's income tax liability based on Nigeria's 2026 tax law. Determine if you qualify for small company exemption or standard corporate tax rates.</p>
            
            <div class="tool-form">
                <div class="input-group">
                    <label>Annual Gross Turnover/Revenue (₦)</label>
                    <input type="text" id="citTurnover" value="50,000,000.00" onblur="formatAmountInput(this)" onfocus="this.value = this.value.replace(/,/g, '')" placeholder="Enter annual turnover">
                </div>
                <div class="input-grid">
                    <div class="input-group">
                        <label>Total Fixed Assets (₦)</label>
                        <input type="text" id="citAssets" value="100,000,000.00" onblur="formatAmountInput(this)" onfocus="this.value = this.value.replace(/,/g, '')" placeholder="Enter total fixed assets">
                    </div>
                    <div class="input-group">
                        <label>Company Type</label>
                        <select id="citCompanyType" style="width: 100%; padding: 12px; font-size: 1rem; border: 1px solid var(--border); border-radius: 8px; background: var(--white);">
                            <option value="regular">Regular Company</option>
                            <option value="professional">Professional Services</option>
                        </select>
                    </div>
                </div>
                <div class="input-group">
                    <label>Operating Expenses/Deductions (₦)</label>
                    <input type="text" id="citExpenses" value="20,000,000.00" onblur="formatAmountInput(this)" onfocus="this.value = this.value.replace(/,/g, '')" placeholder="Enter total deductions">
                </div>
                <button class="btn-calc" onclick="calculateCompanyIncomeTax()">Calculate Tax</button>
                
                <div class="result-box" id="citResultBox">
                    <div class="result-header">
                        <div class="result-label">Annual Tax Payable</div>
                        <div class="result-val" id="citResult">₦0.00</div>
                        <div class="result-conversion">
                            <span class="currency-item" id="citUSD">$0.00</span>
                            <span class="currency-item" id="citGBP">£0.00</span>
                        </div>
                    </div>
                    <div class="result-details">
                        <div class="result-details-row">
                            <strong>Company Category:</strong>
                            <span id="citCategory" style="color: var(--success); font-weight: bold;">-</span>
                        </div>
                        <div class="result-details-row">
                            <strong>Taxable Profit:</strong>
                            <span id="citTaxableProfit">₦0.00</span>
                        </div>
                        <div class="result-details-row">
                            <strong>Tax Rate Applied:</strong>
                            <span id="citTaxRate">0%</span>
                        </div>
                        <div class="result-details-row">
                            <strong>Effective Tax Rate:</strong>
                            <span id="citEffectiveRate">0%</span>
                        </div>
                        <div class="result-details-row">
                            <strong>Net Profit After Tax:</strong>
                            <span id="citNetProfit" style="color: var(--success); font-weight: bold;">₦0.00</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Break-Even Calculator -->
        <div class="tool-view" id="tool-breakeven">
            <h2>
                Break-Even Calculator
                <span class="info-icon">
                    <span style="color: var(--accent); font-size: 1.2rem;">ℹ️</span>
                    <span class="tooltip">Calculate the number of units or revenue needed to cover all costs. Essential for pricing decisions and understanding when your business becomes profitable.</span>
                </span>
            </h2>
            <p class="tool-description">Determine the break-even point where total revenue equals total costs. Essential for pricing decisions and understanding profitability thresholds.</p>
            
            <div class="tool-form">
                <div class="input-group">
                    <label>Fixed Costs (₦)</label>
                    <input type="text" id="beFixedCosts" value="500,000.00" onblur="formatAmountInput(this)" onfocus="this.value = this.value.replace(/,/g, '')" placeholder="Rent, salaries, insurance, etc.">
                </div>
                <div class="input-grid">
                    <div class="input-group">
                        <label>Variable Cost per Unit (₦)</label>
                        <input type="text" id="beVariableCost" value="500.00" onblur="formatAmountInput(this)" onfocus="this.value = this.value.replace(/,/g, '')" placeholder="Cost per item/service">
                    </div>
                    <div class="input-group">
                        <label>Selling Price per Unit (₦)</label>
                        <input type="text" id="beSellingPrice" value="1,500.00" onblur="formatAmountInput(this)" onfocus="this.value = this.value.replace(/,/g, '')" placeholder="Price per item/service">
                    </div>
                </div>
                <button class="btn-calc" onclick="calculateBreakEven()">Calculate Break-Even</button>
                
                <div class="result-box" id="beResultBox">
                    <div class="result-header">
                        <div class="result-label">Break-Even Point</div>
                        <div class="result-val" id="beResult">0 units</div>
                        <div class="result-conversion">
                            <span class="currency-item" id="beRevenueUSD">$0.00</span>
                            <span class="currency-item" id="beRevenueGBP">£0.00</span>
                        </div>
                    </div>
                    <div class="result-details">
                        <div class="result-details-row">
                            <strong>Break-Even Revenue:</strong>
                            <span id="beRevenue">₦0.00</span>
                        </div>
                        <div class="result-details-row">
                            <strong>Break-Even Units:</strong>
                            <span id="beUnits">0</span>
                        </div>
                        <div class="result-details-row">
                            <strong>Contribution Margin per Unit:</strong>
                            <span id="beContributionMargin">₦0.00</span>
                        </div>
                        <div class="result-details-row">
                            <strong>Contribution Margin Ratio:</strong>
                            <span id="beMarginRatio">0%</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Cash Flow Forecast -->
        <div class="tool-view" id="tool-cashflow">
            <h2>
                Cash Flow Forecast
                <span class="info-icon">
                    <span style="color: var(--accent); font-size: 1.2rem;">ℹ️</span>
                    <span class="tooltip">Project your monthly cash inflows and outflows to identify potential cash shortages. Critical for business survival and planning.</span>
                </span>
            </h2>
            <p class="tool-description">Project your monthly cash inflows and outflows to identify potential cash shortages and plan for adequate funding.</p>
            
            <div class="tool-form">
                <div class="input-group">
                    <label>Starting Cash Balance (₦)</label>
                    <input type="text" id="cfStartingBalance" value="1,000,000.00" onblur="formatAmountInput(this)" onfocus="this.value = this.value.replace(/,/g, '')" placeholder="Current cash on hand">
                </div>
                <div class="input-group">
                    <label>Monthly Cash Inflows (₦)</label>
                    <input type="text" id="cfInflows" value="2,500,000.00" onblur="formatAmountInput(this)" onfocus="this.value = this.value.replace(/,/g, '')" placeholder="Sales, receivables, etc.">
                </div>
                <div class="input-group">
                    <label>Monthly Cash Outflows (₦)</label>
                    <input type="text" id="cfOutflows" value="2,200,000.00" onblur="formatAmountInput(this)" onfocus="this.value = this.value.replace(/,/g, '')" placeholder="Expenses, payables, etc.">
                </div>
                <div class="input-group">
                    <label>Forecast Period (Months)</label>
                    <input type="number" id="cfMonths" value="12" min="1" max="60" placeholder="Number of months to forecast">
                </div>
                <button class="btn-calc" onclick="calculateCashFlow()">Generate Forecast</button>
                
                <div class="result-box" id="cfResultBox">
                    <div class="result-header">
                        <div class="result-label">Ending Cash Balance</div>
                        <div class="result-val" id="cfEndingBalance">₦0.00</div>
                        <div class="result-conversion">
                            <span class="currency-item" id="cfEndingUSD">$0.00</span>
                            <span class="currency-item" id="cfEndingGBP">£0.00</span>
                        </div>
                    </div>
                    <div class="result-details">
                        <div class="result-details-row">
                            <strong>Net Cash Flow per Month:</strong>
                            <span id="cfNetMonthly">₦0.00</span>
                        </div>
                        <div class="result-details-row">
                            <strong>Total Cash Inflows:</strong>
                            <span id="cfTotalInflows">₦0.00</span>
                        </div>
                        <div class="result-details-row">
                            <strong>Total Cash Outflows:</strong>
                            <span id="cfTotalOutflows">₦0.00</span>
                        </div>
                        <div class="result-details-row">
                            <strong>Lowest Cash Balance:</strong>
                            <span id="cfLowestBalance" style="color: var(--live); font-weight: bold;">₦0.00</span>
                        </div>
                        <div class="result-details-row">
                            <strong>Months with Negative Balance:</strong>
                            <span id="cfNegativeMonths" style="color: var(--live); font-weight: bold;">0</span>
                        </div>
                    </div>
                    <div id="cfMonthlyBreakdown" style="margin-top: 25px; padding-top: 25px; border-top: 1px solid var(--border);">
                        <strong style="display: block; margin-bottom: 15px; color: var(--primary);">Monthly Breakdown:</strong>
                        <div id="cfMonthlyTable" style="max-height: 400px; overflow-y: auto;">
                            <!-- Monthly breakdown will be generated here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Profit Margin Calculator -->
        <div class="tool-view" id="tool-profitmargin">
            <h2>
                Profit Margin Calculator
                <span class="info-icon">
                    <span style="color: var(--accent); font-size: 1.2rem;">ℹ️</span>
                    <span class="tooltip">Calculate gross, operating, and net profit margins. Compare profitability across products, services, or time periods to make informed business decisions.</span>
                </span>
            </h2>
            <p class="tool-description">Calculate gross, operating, and net profit margins to analyze profitability and make informed pricing decisions.</p>
            
            <div class="tool-form">
                <div class="input-group">
                    <label>Revenue/Sales (₦)</label>
                    <input type="text" id="pmRevenue" value="10,000,000.00" onblur="formatAmountInput(this)" onfocus="this.value = this.value.replace(/,/g, '')" placeholder="Total sales/revenue">
                </div>
                <div class="input-group">
                    <label>Cost of Goods Sold (COGS) (₦)</label>
                    <input type="text" id="pmCogs" value="6,000,000.00" onblur="formatAmountInput(this)" onfocus="this.value = this.value.replace(/,/g, '')" placeholder="Direct costs of production">
                </div>
                <div class="input-group">
                    <label>Operating Expenses (₦)</label>
                    <input type="text" id="pmOperatingExpenses" value="2,500,000.00" onblur="formatAmountInput(this)" onfocus="this.value = this.value.replace(/,/g, '')" placeholder="Rent, salaries, utilities, etc.">
                </div>
                <div class="input-group">
                    <label>Other Expenses (₦) <small style="color: var(--text-light);">(Optional - Taxes, Interest, etc.)</small></label>
                    <input type="text" id="pmOtherExpenses" value="0.00" onblur="formatAmountInput(this)" onfocus="this.value = this.value.replace(/,/g, '')" placeholder="Taxes, interest, one-time expenses">
                </div>
                <button class="btn-calc" onclick="calculateProfitMargin()">Calculate Margins</button>
                
                <div class="result-box" id="pmResultBox">
                    <div class="result-header">
                        <div class="result-label">Net Profit Margin</div>
                        <div class="result-val" id="pmNetMargin">0%</div>
                        <div class="result-conversion">
                            <span class="currency-item" id="pmNetProfitUSD">$0.00</span>
                            <span class="currency-item" id="pmNetProfitGBP">£0.00</span>
                        </div>
                    </div>
                    <div class="result-details">
                        <div class="result-details-row">
                            <strong>Gross Profit:</strong>
                            <span id="pmGrossProfit">₦0.00</span>
                        </div>
                        <div class="result-details-row">
                            <strong>Gross Profit Margin:</strong>
                            <span id="pmGrossMargin">0%</span>
                        </div>
                        <div class="result-details-row">
                            <strong>Operating Profit:</strong>
                            <span id="pmOperatingProfit">₦0.00</span>
                        </div>
                        <div class="result-details-row">
                            <strong>Operating Profit Margin:</strong>
                            <span id="pmOperatingMargin">0%</span>
                        </div>
                        <div class="result-details-row">
                            <strong>Net Profit:</strong>
                            <span id="pmNetProfit" style="color: var(--success); font-weight: bold;">₦0.00</span>
                        </div>
                        <div class="result-details-row">
                            <strong>Net Profit Margin:</strong>
                            <span id="pmNetMarginDetail">0%</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Payroll Calculator (Nigeria) -->
        <div class="tool-view" id="tool-payroll">
            <h2>
                Payroll Calculator (Nigeria)
                <span class="info-icon">
                    <span style="color: var(--accent); font-size: 1.2rem;">ℹ️</span>
                    <span class="tooltip">Calculate employee salaries with Nigerian deductions: Pension (8%), NHF (2.5%), PAYE tax, and other statutory deductions. Essential for compliance and payroll planning.</span>
                </span>
            </h2>
            <p class="tool-description">Calculate employee take-home pay with all Nigerian statutory deductions including Pension, NHF, and PAYE tax.</p>
            
            <div class="tool-form">
                <div class="input-group">
                    <label>Monthly Gross Salary (₦)</label>
                    <input type="text" id="payrollGrossSalary" value="500,000.00" onblur="formatAmountInput(this)" onfocus="this.value = this.value.replace(/,/g, '')" placeholder="Monthly gross salary">
                </div>
                <div class="input-grid">
                    <div class="input-group">
                        <label style="display: flex; align-items: center; gap: 5px;">
                            <span>Annual Rent (₦)</span>
                            <span class="info-icon">
                                <span style="color: var(--accent); font-size: 1rem;">ℹ️</span>
                                <span class="tooltip">For rent relief calculation (20% of annual rent, capped at ₦500,000)</span>
                            </span>
                        </label>
                        <input type="text" id="payrollRent" value="0.00" onblur="formatAmountInput(this)" onfocus="this.value = this.value.replace(/,/g, '')" placeholder="Annual rent">
                    </div>
                    <div class="input-group">
                        <label style="display: flex; align-items: center; gap: 5px;">
                            <span>Life Insurance (₦)</span>
                            <span class="info-icon">
                                <span style="color: var(--accent); font-size: 1rem;">ℹ️</span>
                                <span class="tooltip">Life insurance premium (up to ₦100,000 deductible)</span>
                            </span>
                        </label>
                        <input type="text" id="payrollInsurance" value="0.00" onblur="formatAmountInput(this)" onfocus="this.value = this.value.replace(/,/g, '')" placeholder="Annual insurance premium">
                    </div>
                </div>
                <div class="input-group">
                    <label>NHIS Contribution (₦) <small style="color: var(--text-light);">(Optional)</small></label>
                    <input type="text" id="payrollNHIS" value="0.00" onblur="formatAmountInput(this)" onfocus="this.value = this.value.replace(/,/g, '')" placeholder="NHIS contribution">
                </div>
                <button class="btn-calc" onclick="calculatePayroll()">Calculate Payroll</button>
                
                <div class="result-box" id="payrollResultBox">
                    <div class="result-header">
                        <div class="result-label">Monthly Take-Home Pay</div>
                        <div class="result-val" id="payrollTakeHome" style="color: var(--success);">₦0.00</div>
                        <div class="result-conversion">
                            <span class="currency-item" id="payrollTakeHomeUSD">$0.00</span>
                            <span class="currency-item" id="payrollTakeHomeGBP">£0.00</span>
                        </div>
                    </div>
                    <div class="result-details">
                        <div class="result-details-row">
                            <strong>Annual Gross Salary:</strong>
                            <span id="payrollAnnualGross">₦0.00</span>
                        </div>
                        <div class="result-details-row">
                            <strong>Pension Contribution (8%):</strong>
                            <span id="payrollPension">₦0.00</span>
                        </div>
                        <div class="result-details-row">
                            <strong>NHF Contribution (2.5%):</strong>
                            <span id="payrollNHF">₦0.00</span>
                        </div>
                        <div class="result-details-row">
                            <strong>PAYE Tax:</strong>
                            <span id="payrollPAYE">₦0.00</span>
                        </div>
                        <div class="result-details-row">
                            <strong>Total Deductions:</strong>
                            <span id="payrollTotalDeductions">₦0.00</span>
                        </div>
                        <div class="result-details-row">
                            <strong>Monthly Net Salary:</strong>
                            <span id="payrollNetSalary" style="color: var(--success); font-weight: bold;">₦0.00</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ROI Calculator -->
        <div class="tool-view" id="tool-roi">
            <h2>
                ROI Calculator
                <span class="info-icon">
                    <span style="color: var(--accent); font-size: 1.2rem;">ℹ️</span>
                    <span class="tooltip">Calculate Return on Investment to evaluate the profitability of investments. Compare different investment options to make informed financial decisions.</span>
                </span>
            </h2>
            <p class="tool-description">Calculate Return on Investment (ROI) to evaluate the profitability of investments and compare different investment options.</p>
            
            <div class="tool-form">
                <div class="input-group">
                    <label>Initial Investment (₦)</label>
                    <input type="text" id="roiInitialInvestment" value="5,000,000.00" onblur="formatAmountInput(this)" onfocus="this.value = this.value.replace(/,/g, '')" placeholder="Amount invested">
                </div>
                <div class="input-group">
                    <label>Final Value / Return (₦)</label>
                    <input type="text" id="roiFinalValue" value="7,500,000.00" onblur="formatAmountInput(this)" onfocus="this.value = this.value.replace(/,/g, '')" placeholder="Total return or final value">
                </div>
                <div class="input-group">
                    <label>Investment Period (Years)</label>
                    <input type="number" id="roiYears" value="2" step="0.1" min="0.1" placeholder="Number of years">
                </div>
                <button class="btn-calc" onclick="calculateROI()">Calculate ROI</button>
                
                <div class="result-box" id="roiResultBox">
                    <div class="result-header">
                        <div class="result-label">Return on Investment (ROI)</div>
                        <div class="result-val" id="roiPercentage">0%</div>
                        <div class="result-conversion">
                            <span class="currency-item" id="roiNetProfitUSD">$0.00</span>
                            <span class="currency-item" id="roiNetProfitGBP">£0.00</span>
                        </div>
                    </div>
                    <div class="result-details">
                        <div class="result-details-row">
                            <strong>Net Profit:</strong>
                            <span id="roiNetProfit">₦0.00</span>
                        </div>
                        <div class="result-details-row">
                            <strong>ROI Percentage:</strong>
                            <span id="roiPercent">0%</span>
                        </div>
                        <div class="result-details-row">
                            <strong>Annualized ROI:</strong>
                            <span id="roiAnnualized">0%</span>
                        </div>
                        <div class="result-details-row">
                            <strong>Total Return:</strong>
                            <span id="roiTotalReturn" style="color: var(--success); font-weight: bold;">₦0.00</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
</div>

<script>
    // ============================================
    // CRITICAL: Define these functions FIRST so they're available for onclick handlers
    // ============================================
    
    // Tool switching functionality - Define immediately on window
    window.showTool = function(toolId) {
        console.log('showTool called with:', toolId);
        if (!toolId) {
            console.error('showTool called without toolId');
            return;
        }
        
        try {
            // Check if tool is visible (from API)
            let isVisible = true; // Default to visible
            try {
                const visResponse = await fetch('/api/tools/visibility');
                if (visResponse.ok) {
                    const visData = await visResponse.json();
                    isVisible = visData.visibility[toolId] !== false; // Default to true if not set
                }
            } catch (visError) {
                console.warn('Could not load tool visibility, defaulting to visible:', visError);
            }
            
            if (!isVisible) {
                // Tool is hidden, don't show it
                console.log('Tool', toolId, 'is hidden');
                return;
            }
            
            // Hide all tool views
            const allViews = document.querySelectorAll('.tool-view');
            allViews.forEach(view => view.classList.remove('active'));
            
            // Show selected tool
            const selectedView = document.getElementById('tool-' + toolId);
            if (selectedView) {
                selectedView.classList.add('active');
            } else {
                console.error('Tool view not found:', 'tool-' + toolId);
                return;
            }
            
            // Update menu active state
            const menuItems = document.querySelectorAll('.tools-menu a');
            menuItems.forEach(item => {
                item.classList.remove('active');
                if (item.getAttribute('data-tool') === toolId) {
                    item.classList.add('active');
                }
            });
            
            // Close mobile menu if open
            const sidebar = document.getElementById('toolsSidebar');
            if (sidebar && window.innerWidth <= 1024) {
                sidebar.classList.remove('show');
            }
        } catch (error) {
            console.error('Error in showTool:', error);
            alert('Error switching tool: ' + error.message);
        }
    };

    // Mobile menu toggle - Define immediately on window
    window.toggleSidebar = function() {
        const sidebar = document.getElementById('toolsSidebar');
        if (sidebar) {
            sidebar.classList.toggle('show');
        }
    };

    // ============================================
    // Currency Exchange Rates and other functions
    // ============================================
    
    // Currency Exchange Rates - Load from localStorage or use defaults
    let NGN_TO_USD = 1450;
    let NGN_TO_GBP = 1850;
    
    // Load exchange rates from localStorage (set by admin)
    function loadExchangeRates() {
        const savedRates = JSON.parse(localStorage.getItem('exchangeRates') || '{}');
        if (savedRates.usd) {
            NGN_TO_USD = parseFloat(savedRates.usd) || 1450;
        }
        if (savedRates.gbp) {
            NGN_TO_GBP = parseFloat(savedRates.gbp) || 1850;
        }
        console.log('Loaded exchange rates:', { USD: NGN_TO_USD, GBP: NGN_TO_GBP });
    }
    
    // Load calculator defaults from localStorage (set by admin)
    function loadCalculatorDefaults() {
        const defaults = JSON.parse(localStorage.getItem('calculatorDefaults') || '{}');
        
        if (defaults.loanRate) {
            const loanRateInput = document.getElementById('loanRate');
            if (loanRateInput) loanRateInput.value = defaults.loanRate;
        }
        if (defaults.loanTerm) {
            const loanTermInput = document.getElementById('loanTerm');
            if (loanTermInput) loanTermInput.value = defaults.loanTerm;
        }
        if (defaults.mortgageRate) {
            const mortgageRateInput = document.getElementById('mortgageRate');
            if (mortgageRateInput) mortgageRateInput.value = defaults.mortgageRate;
        }
        if (defaults.mortgageTerm) {
            const mortgageTermInput = document.getElementById('mortgageTerm');
            if (mortgageTermInput) mortgageTermInput.value = defaults.mortgageTerm;
        }
        
        console.log('Loaded calculator defaults:', defaults);
    }
    
    // Don't call loadExchangeRates here - wait for window.onload

    // Load and apply tool visibility settings - Using API
    async function loadToolVisibility() {
        try {
            // Load visibility from API
            const visResponse = await fetch('/api/tools/visibility');
            let visibilitySettings = {};
            if (visResponse.ok) {
                const visData = await visResponse.json();
                visibilitySettings = visData.visibility || {};
            } else {
                // If API fails, default all tools to visible
                console.warn('Could not load tool visibility from API, defaulting all to visible');
            }
            
            const menuItems = document.querySelectorAll('.tools-menu a');
            
            if (!menuItems || menuItems.length === 0) {
                return; // DOM not ready yet
            }
            
            // Hide/show menu items and tool views based on visibility
            menuItems.forEach(item => {
                const toolId = item.getAttribute('data-tool');
                if (!toolId) return;
                
                const isVisible = visibilitySettings[toolId] !== false; // Default to true
                
                if (!isVisible) {
                    item.style.display = 'none';
                    // Hide corresponding tool view
                    const toolView = document.getElementById('tool-' + toolId);
                    if (toolView) {
                        toolView.style.display = 'none';
                    }
                } else {
                    item.style.display = '';
                }
            });
            
            // Find first visible tool and make it active if current active tool is hidden
            const activeMenuItem = document.querySelector('.tools-menu a.active');
            if (activeMenuItem && activeMenuItem.style.display === 'none') {
                // Current active tool is hidden, switch to first visible tool
                let firstVisibleTool = null;
                menuItems.forEach(item => {
                    if (item.style.display !== 'none' && !firstVisibleTool) {
                        firstVisibleTool = item.getAttribute('data-tool');
                    }
                });
                if (firstVisibleTool && typeof showTool === 'function') {
                    showTool(firstVisibleTool);
                }
            }
        } catch (error) {
            console.error('Error in loadToolVisibility:', error);
        }
    }


    // Helper function to parse formatted amount input (removes commas)
    function parseAmountInput(value) {
        return parseFloat(value.toString().replace(/,/g, '')) || 0;
    }

    // Helper function to format amount input with commas and 2 decimal places
    function formatAmountInput(input) {
        let value = input.value.replace(/,/g, '');
        if (value === '' || isNaN(value)) {
            input.value = '0.00';
            return;
        }
        let num = parseFloat(value);
        if (isNaN(num)) {
            input.value = '0.00';
            return;
        }
        input.value = num.toLocaleString('en-US', {
            minimumFractionDigits: 2,
            maximumFractionDigits: 2
        });
    }

    // Helper function to format numbers as Naira
    function formatNaira(amount) {
        return '₦' + parseFloat(amount).toLocaleString('en-NG', {
            minimumFractionDigits: 2,
            maximumFractionDigits: 2
        });
    }

    // Helper function for $ and £
    function formatForeign(amount, currency) {
        const symbols = { 'USD': '$', 'GBP': '£' };
        return symbols[currency] + parseFloat(amount).toLocaleString('en-US', {
            minimumFractionDigits: 2,
            maximumFractionDigits: 2
        });
    }

    function calculateLoan() {
        const P = parseAmountInput(document.getElementById('loanAmount').value);
        const r = (parseFloat(document.getElementById('loanRate').value) / 100) / 12;
        const n = parseFloat(document.getElementById('loanTerm').value);
        const annualRate = parseFloat(document.getElementById('loanRate').value);

        let monthly;
        if (r === 0) {
            monthly = P / n;
        } else {
            monthly = (P * r * Math.pow(1 + r, n)) / (Math.pow(1 + r, n) - 1);
        }
        
        const totalPayable = monthly * n;
        const totalInterest = totalPayable - P;
        
        document.getElementById('loanResult').innerText = formatNaira(monthly);
        document.getElementById('loanUSD').innerText = formatForeign(monthly / NGN_TO_USD, 'USD');
        document.getElementById('loanGBP').innerText = formatForeign(monthly / NGN_TO_GBP, 'GBP');
        document.getElementById('loanAmountDisplay').innerText = formatNaira(P);
        document.getElementById('loanRateDisplay').innerText = annualRate.toFixed(2) + '%';
        document.getElementById('loanTermDisplay').innerText = n + ' months';
        document.getElementById('loanTotalInterest').innerText = formatNaira(totalInterest);
        document.getElementById('loanTotalPayable').innerText = formatNaira(totalPayable);
        document.getElementById('loanResultBox').classList.add('show');
    }

    function updateLoanAmount() {
        const price = parseAmountInput(document.getElementById('propPrice').value);
        const down = parseAmountInput(document.getElementById('downPayment').value);
        const loanAmount = price - down;
        const loanAmountInput = document.getElementById('loanAmountMortgage');
        loanAmountInput.value = loanAmount.toLocaleString('en-US', {
            minimumFractionDigits: 2,
            maximumFractionDigits: 2
        });
    }

    function calculateMortgage() {
        const price = parseAmountInput(document.getElementById('propPrice').value);
        const down = parseAmountInput(document.getElementById('downPayment').value);
        const P = price - down;
        const r = (parseFloat(document.getElementById('mortgageRate').value) / 100) / 12;
        const n = parseFloat(document.getElementById('mortgageTerm').value) * 12;
        const annualRate = parseFloat(document.getElementById('mortgageRate').value);
        const termYears = parseFloat(document.getElementById('mortgageTerm').value);

        let monthly;
        if (r === 0) {
            monthly = P / n;
        } else {
            monthly = (P * r * Math.pow(1 + r, n)) / (Math.pow(1 + r, n) - 1);
        }
        
        const totalPayable = monthly * n;
        const totalInterest = totalPayable - P;
        
        document.getElementById('mortgageResult').innerText = formatNaira(monthly);
        document.getElementById('mortgageUSD').innerText = formatForeign(monthly / NGN_TO_USD, 'USD');
        document.getElementById('mortgageGBP').innerText = formatForeign(monthly / NGN_TO_GBP, 'GBP');
        document.getElementById('mortgagePropertyPrice').innerText = formatNaira(price);
        document.getElementById('mortgageLoanAmount').innerText = formatNaira(P);
        document.getElementById('mortgageDownPayment').innerText = formatNaira(down);
        document.getElementById('mortgageRateDisplay').innerText = annualRate.toFixed(2) + '%';
        document.getElementById('mortgageTermDisplay').innerText = termYears + ' years';
        document.getElementById('mortgageTotalInterest').innerText = formatNaira(totalInterest);
        document.getElementById('mortgageTotalPayable').innerText = formatNaira(totalPayable);
        document.getElementById('mortgageResultBox').classList.add('show');
    }

    function calculateSavingsTarget() {
        const targetType = document.getElementById('targetType').value;
        const targetAmount = parseAmountInput(document.getElementById('targetAmount').value);
        const dueDateInput = document.getElementById('dueDate').value;

        if (targetAmount <= 0) {
            alert('Please enter a valid target amount.');
            return;
        }

        if (!dueDateInput) {
            alert('Please select a target month/year.');
            return;
        }

        const [year, month] = dueDateInput.split('-');
        const dueDate = new Date(parseInt(year), parseInt(month) - 1, 1);
        const today = new Date();
        today.setHours(0, 0, 0, 0);
        const todayMonth = new Date(today.getFullYear(), today.getMonth(), 1);

        if (dueDate <= todayMonth) {
            alert('Target month must be in the future. Please select a future month.');
            return;
        }

        const monthsRemaining = (dueDate.getFullYear() - todayMonth.getFullYear()) * 12 + 
                                (dueDate.getMonth() - todayMonth.getMonth());
        
        if (monthsRemaining <= 0) {
            alert('Invalid month calculation. Please check your target month.');
            return;
        }

        const monthlySavings = targetAmount / monthsRemaining;
        const formattedDate = dueDate.toLocaleDateString('en-US', { 
            year: 'numeric', 
            month: 'long'
        });

        document.getElementById('savingsResult').innerText = formatNaira(monthlySavings);
        document.getElementById('totalBudgetDisplay').innerText = formatNaira(targetAmount);
        document.getElementById('dueDateDisplay').innerText = formattedDate;
        document.getElementById('monthlyTargetDisplay').innerText = formatNaira(monthlySavings);
        document.getElementById('monthsRemaining').innerText = monthsRemaining;
        document.getElementById('paymentText').innerText = monthsRemaining === 1 ? 'payment' : 'payments';
        
        document.getElementById('savingsUSD').innerText = formatForeign(monthlySavings / NGN_TO_USD, 'USD');
        document.getElementById('savingsGBP').innerText = formatForeign(monthlySavings / NGN_TO_GBP, 'GBP');
        
        document.getElementById('savingsResultBox').classList.add('show');
    }

    function calculatePersonalIncomeTax() {
        const grossSalary = parseAmountInput(document.getElementById('annualSalary').value);
        const annualRent = parseAmountInput(document.getElementById('annualRent').value);
        const lifeInsurance = parseAmountInput(document.getElementById('lifeInsurance').value);
        const nhisContribution = parseAmountInput(document.getElementById('nhisContribution').value);

        if (grossSalary <= 0) {
            alert('Please enter a valid annual salary.');
            return;
        }

        const pensionContribution = grossSalary * 0.08;
        const nhfContribution = grossSalary * 0.025;
        const lifeInsuranceDeduction = Math.min(lifeInsurance, 100000);
        const rentRelief = Math.min(annualRent * 0.20, 500000);
        const nhisDeduction = nhisContribution;
        
        const totalDeductions = pensionContribution + nhfContribution + lifeInsuranceDeduction + rentRelief + nhisDeduction;
        const taxableIncome = Math.max(0, grossSalary - totalDeductions);
        
        let totalTax = 0;
        
        if (taxableIncome <= 800000) {
            totalTax = 0;
        } else {
            if (taxableIncome > 3000000) {
                totalTax += (3000000 - 800000) * 0.15;
            } else {
                totalTax += (taxableIncome - 800000) * 0.15;
            }
            
            if (taxableIncome > 12000000) {
                totalTax += (12000000 - 3000000) * 0.18;
            } else if (taxableIncome > 3000000) {
                totalTax += (taxableIncome - 3000000) * 0.18;
            }
            
            if (taxableIncome > 25000000) {
                totalTax += (25000000 - 12000000) * 0.21;
            } else if (taxableIncome > 12000000) {
                totalTax += (taxableIncome - 12000000) * 0.21;
            }
            
            if (taxableIncome > 50000000) {
                totalTax += (50000000 - 25000000) * 0.23;
            } else if (taxableIncome > 25000000) {
                totalTax += (taxableIncome - 25000000) * 0.23;
            }
            
            if (taxableIncome > 50000000) {
                totalTax += (taxableIncome - 50000000) * 0.25;
            }
        }
        
        const monthlyTax = totalTax / 12;
        const netIncome = grossSalary - totalTax;
        const effectiveTaxRate = grossSalary > 0 ? (totalTax / grossSalary) * 100 : 0;
        
        document.getElementById('taxResult').innerText = formatNaira(totalTax);
        document.getElementById('monthlyTax').innerText = formatNaira(monthlyTax);
        document.getElementById('taxableIncome').innerText = formatNaira(taxableIncome);
        document.getElementById('totalDeductions').innerText = formatNaira(totalDeductions);
        document.getElementById('netIncome').innerText = formatNaira(netIncome);
        document.getElementById('effectiveTaxRate').innerText = effectiveTaxRate.toFixed(2) + '%';
        
        document.getElementById('taxUSD').innerText = formatForeign(totalTax / NGN_TO_USD, 'USD');
        document.getElementById('taxGBP').innerText = formatForeign(totalTax / NGN_TO_GBP, 'GBP');
        
        document.getElementById('taxResultBox').classList.add('show');
    }

    function calculateCompanyIncomeTax() {
        const turnover = parseAmountInput(document.getElementById('citTurnover').value);
        const assets = parseAmountInput(document.getElementById('citAssets').value);
        const expenses = parseAmountInput(document.getElementById('citExpenses').value);
        const companyType = document.getElementById('citCompanyType').value;

        if (turnover <= 0) {
            alert('Please enter a valid annual turnover.');
            return;
        }

        // Calculate taxable profit
        const taxableProfit = Math.max(0, turnover - expenses);

        // Determine company category and tax rate
        let taxRate = 0;
        let category = '';
        let totalTax = 0;
        const SMALL_COMPANY_TURNOVER_LIMIT = 100000000; // ₦100M
        const SMALL_COMPANY_ASSETS_LIMIT = 250000000; // ₦250M
        const LARGE_COMPANY_TURNOVER_LIMIT = 20000000000; // ₦20B
        const MIN_ETR = 0.15; // 15% minimum effective tax rate for large companies

        // Check if small company (exempt from CIT)
        if (companyType === 'regular' && 
            turnover <= SMALL_COMPANY_TURNOVER_LIMIT && 
            assets <= SMALL_COMPANY_ASSETS_LIMIT) {
            // Small company - 0% CIT
            category = 'Small Company (Exempt)';
            taxRate = 0;
            totalTax = 0;
        } else {
            // Regular company - 30% CIT
            category = 'Regular Company';
            taxRate = 30;
            totalTax = taxableProfit * 0.30;

            // Check if large company (minimum 15% ETR)
            if (turnover >= LARGE_COMPANY_TURNOVER_LIMIT) {
                const effectiveRate = (totalTax / turnover) * 100;
                if (effectiveRate < 15) {
                    // Apply minimum ETR of 15%
                    totalTax = turnover * MIN_ETR;
                    category = 'Large Company (Minimum ETR Applied)';
                    taxRate = 15; // Effective rate
                } else {
                    category = 'Large Company';
                }
            }
        }

        const effectiveTaxRate = turnover > 0 ? (totalTax / turnover) * 100 : 0;
        const netProfit = turnover - expenses - totalTax;

        // Display results
        document.getElementById('citResult').innerText = formatNaira(totalTax);
        document.getElementById('citCategory').innerText = category;
        document.getElementById('citTaxableProfit').innerText = formatNaira(taxableProfit);
        document.getElementById('citTaxRate').innerText = taxRate + '%';
        document.getElementById('citEffectiveRate').innerText = effectiveTaxRate.toFixed(2) + '%';
        document.getElementById('citNetProfit').innerText = formatNaira(netProfit);
        
        document.getElementById('citUSD').innerText = formatForeign(totalTax / NGN_TO_USD, 'USD');
        document.getElementById('citGBP').innerText = formatForeign(totalTax / NGN_TO_GBP, 'GBP');
        
        document.getElementById('citResultBox').classList.add('show');
    }

    function calculateBreakEven() {
        try {
            const fixedCosts = parseAmountInput(document.getElementById('beFixedCosts').value);
            const variableCost = parseAmountInput(document.getElementById('beVariableCost').value);
            const sellingPrice = parseAmountInput(document.getElementById('beSellingPrice').value);

            if (fixedCosts <= 0 || sellingPrice <= 0) {
                alert('Please enter valid values for fixed costs and selling price.');
                return;
            }

            if (sellingPrice <= variableCost) {
                alert('Selling price must be greater than variable cost per unit to break even.');
                return;
            }

            // Calculate contribution margin per unit
            const contributionMargin = sellingPrice - variableCost;
            
            // Calculate break-even units
            const breakEvenUnits = Math.ceil(fixedCosts / contributionMargin);
            
            // Calculate break-even revenue
            const breakEvenRevenue = breakEvenUnits * sellingPrice;
            
            // Calculate contribution margin ratio
            const marginRatio = (contributionMargin / sellingPrice) * 100;

            // Display results
            document.getElementById('beResult').innerText = breakEvenUnits.toLocaleString() + ' units';
            document.getElementById('beRevenue').innerText = formatNaira(breakEvenRevenue);
            document.getElementById('beUnits').innerText = breakEvenUnits.toLocaleString();
            document.getElementById('beContributionMargin').innerText = formatNaira(contributionMargin);
            document.getElementById('beMarginRatio').innerText = marginRatio.toFixed(2) + '%';
            
            document.getElementById('beRevenueUSD').innerText = formatForeign(breakEvenRevenue / NGN_TO_USD, 'USD');
            document.getElementById('beRevenueGBP').innerText = formatForeign(breakEvenRevenue / NGN_TO_GBP, 'GBP');
            
            const resultBox = document.getElementById('beResultBox');
            if (resultBox) {
                resultBox.classList.add('show');
            }
        } catch (error) {
            console.error('Error in calculateBreakEven:', error);
            alert('An error occurred. Please check the console for details.');
        }
    }

    function calculateCashFlow() {
        try {
            const startingBalance = parseAmountInput(document.getElementById('cfStartingBalance').value);
            const monthlyInflows = parseAmountInput(document.getElementById('cfInflows').value);
            const monthlyOutflows = parseAmountInput(document.getElementById('cfOutflows').value);
            const months = parseInt(document.getElementById('cfMonths').value) || 12;

            if (months < 1 || months > 60) {
                alert('Please enter a forecast period between 1 and 60 months.');
                return;
            }

            const netMonthly = monthlyInflows - monthlyOutflows;
            const endingBalance = startingBalance + (netMonthly * months);
            const totalInflows = monthlyInflows * months;
            const totalOutflows = monthlyOutflows * months;

            // Calculate monthly breakdown and find lowest balance
            let currentBalance = startingBalance;
            let lowestBalance = startingBalance;
            let negativeMonths = 0;
            let monthlyBreakdown = '<table style="width: 100%; border-collapse: collapse; font-size: 0.9rem;"><thead><tr style="background: #f7fafc; border-bottom: 2px solid var(--border);"><th style="padding: 10px; text-align: left;">Month</th><th style="padding: 10px; text-align: right;">Inflow</th><th style="padding: 10px; text-align: right;">Outflow</th><th style="padding: 10px; text-align: right;">Net Flow</th><th style="padding: 10px; text-align: right;">Balance</th></tr></thead><tbody>';

            for (let i = 1; i <= months; i++) {
                currentBalance += netMonthly;
                if (currentBalance < lowestBalance) {
                    lowestBalance = currentBalance;
                }
                if (currentBalance < 0) {
                    negativeMonths++;
                }
                
                const balanceColor = currentBalance < 0 ? 'var(--live)' : 'var(--text)';
                monthlyBreakdown += `<tr style="border-bottom: 1px solid #e2e8f0;">
                    <td style="padding: 8px;">Month ${i}</td>
                    <td style="padding: 8px; text-align: right;">${formatNaira(monthlyInflows)}</td>
                    <td style="padding: 8px; text-align: right;">${formatNaira(monthlyOutflows)}</td>
                    <td style="padding: 8px; text-align: right; color: ${netMonthly >= 0 ? 'var(--success)' : 'var(--live)'}; font-weight: 600;">${formatNaira(netMonthly)}</td>
                    <td style="padding: 8px; text-align: right; color: ${balanceColor}; font-weight: 600;">${formatNaira(currentBalance)}</td>
                </tr>`;
            }
            monthlyBreakdown += '</tbody></table>';

            // Display results
            document.getElementById('cfEndingBalance').innerText = formatNaira(endingBalance);
            document.getElementById('cfNetMonthly').innerText = formatNaira(netMonthly);
            document.getElementById('cfTotalInflows').innerText = formatNaira(totalInflows);
            document.getElementById('cfTotalOutflows').innerText = formatNaira(totalOutflows);
            document.getElementById('cfLowestBalance').innerText = formatNaira(lowestBalance);
            document.getElementById('cfNegativeMonths').innerText = negativeMonths.toString();
            document.getElementById('cfMonthlyTable').innerHTML = monthlyBreakdown;
            
            document.getElementById('cfEndingUSD').innerText = formatForeign(endingBalance / NGN_TO_USD, 'USD');
            document.getElementById('cfEndingGBP').innerText = formatForeign(endingBalance / NGN_TO_GBP, 'GBP');
            
            const resultBox = document.getElementById('cfResultBox');
            if (resultBox) {
                resultBox.classList.add('show');
            }
        } catch (error) {
            console.error('Error in calculateCashFlow:', error);
            alert('An error occurred. Please check the console for details.');
        }
    }

    function calculateProfitMargin() {
        try {
            const revenue = parseAmountInput(document.getElementById('pmRevenue').value);
            const cogs = parseAmountInput(document.getElementById('pmCogs').value);
            const operatingExpenses = parseAmountInput(document.getElementById('pmOperatingExpenses').value);
            const otherExpenses = parseAmountInput(document.getElementById('pmOtherExpenses').value);

            if (revenue <= 0) {
                alert('Please enter a valid revenue amount.');
                return;
            }

            // Calculate gross profit
            const grossProfit = revenue - cogs;
            const grossMargin = revenue > 0 ? (grossProfit / revenue) * 100 : 0;

            // Calculate operating profit
            const operatingProfit = grossProfit - operatingExpenses;
            const operatingMargin = revenue > 0 ? (operatingProfit / revenue) * 100 : 0;

            // Calculate net profit
            const netProfit = operatingProfit - otherExpenses;
            const netMargin = revenue > 0 ? (netProfit / revenue) * 100 : 0;

            // Display results
            document.getElementById('pmGrossProfit').innerText = formatNaira(grossProfit);
            document.getElementById('pmGrossMargin').innerText = grossMargin.toFixed(2) + '%';
            document.getElementById('pmOperatingProfit').innerText = formatNaira(operatingProfit);
            document.getElementById('pmOperatingMargin').innerText = operatingMargin.toFixed(2) + '%';
            document.getElementById('pmNetProfit').innerText = formatNaira(netProfit);
            document.getElementById('pmNetMargin').innerText = netMargin.toFixed(2) + '%';
            document.getElementById('pmNetMarginDetail').innerText = netMargin.toFixed(2) + '%';
            
            document.getElementById('pmNetProfitUSD').innerText = formatForeign(netProfit / NGN_TO_USD, 'USD');
            document.getElementById('pmNetProfitGBP').innerText = formatForeign(netProfit / NGN_TO_GBP, 'GBP');
            
            const resultBox = document.getElementById('pmResultBox');
            if (resultBox) {
                resultBox.classList.add('show');
            }
        } catch (error) {
            console.error('Error in calculateProfitMargin:', error);
            alert('An error occurred. Please check the console for details.');
        }
    }

    function calculatePayroll() {
        try {
            const monthlyGross = parseAmountInput(document.getElementById('payrollGrossSalary').value);
            const annualRent = parseAmountInput(document.getElementById('payrollRent').value);
            const lifeInsurance = parseAmountInput(document.getElementById('payrollInsurance').value);
            const nhisContribution = parseAmountInput(document.getElementById('payrollNHIS').value);

            if (monthlyGross <= 0) {
                alert('Please enter a valid monthly gross salary.');
                return;
            }

            const annualGross = monthlyGross * 12;

            // Calculate deductions (same as PIT calculator)
            const pensionContribution = annualGross * 0.08; // 8%
            const nhfContribution = annualGross * 0.025; // 2.5%
            const lifeInsuranceDeduction = Math.min(lifeInsurance, 100000);
            const rentRelief = Math.min(annualRent * 0.20, 500000);
            const nhisDeduction = nhisContribution;

            // Total deductions
            const totalDeductions = pensionContribution + nhfContribution + lifeInsuranceDeduction + rentRelief + nhisDeduction;

            // Taxable income
            const taxableIncome = Math.max(0, annualGross - totalDeductions);

            // Calculate PAYE tax (same progressive brackets as PIT)
            let payeTax = 0;
            
            if (taxableIncome <= 800000) {
                payeTax = 0;
            } else {
                if (taxableIncome > 3000000) {
                    payeTax += (3000000 - 800000) * 0.15;
                } else {
                    payeTax += (taxableIncome - 800000) * 0.15;
                }
                
                if (taxableIncome > 12000000) {
                    payeTax += (12000000 - 3000000) * 0.18;
                } else if (taxableIncome > 3000000) {
                    payeTax += (taxableIncome - 3000000) * 0.18;
                }
                
                if (taxableIncome > 25000000) {
                    payeTax += (25000000 - 12000000) * 0.21;
                } else if (taxableIncome > 12000000) {
                    payeTax += (taxableIncome - 12000000) * 0.21;
                }
                
                if (taxableIncome > 50000000) {
                    payeTax += (50000000 - 25000000) * 0.23;
                } else if (taxableIncome > 25000000) {
                    payeTax += (taxableIncome - 25000000) * 0.23;
                }
                
                if (taxableIncome > 50000000) {
                    payeTax += (taxableIncome - 50000000) * 0.25;
                }
            }

            // Monthly values
            const monthlyPension = pensionContribution / 12;
            const monthlyNHF = nhfContribution / 12;
            const monthlyPAYE = payeTax / 12;
            const monthlyTotalDeductions = totalDeductions / 12;
            const monthlyNetSalary = monthlyGross - monthlyTotalDeductions - monthlyPAYE;

            // Display results
            document.getElementById('payrollAnnualGross').innerText = formatNaira(annualGross);
            document.getElementById('payrollPension').innerText = formatNaira(monthlyPension);
            document.getElementById('payrollNHF').innerText = formatNaira(monthlyNHF);
            document.getElementById('payrollPAYE').innerText = formatNaira(monthlyPAYE);
            document.getElementById('payrollTotalDeductions').innerText = formatNaira(monthlyTotalDeductions);
            document.getElementById('payrollNetSalary').innerText = formatNaira(monthlyNetSalary);
            document.getElementById('payrollTakeHome').innerText = formatNaira(monthlyNetSalary);
            
            document.getElementById('payrollTakeHomeUSD').innerText = formatForeign(monthlyNetSalary / NGN_TO_USD, 'USD');
            document.getElementById('payrollTakeHomeGBP').innerText = formatForeign(monthlyNetSalary / NGN_TO_GBP, 'GBP');
            
            const resultBox = document.getElementById('payrollResultBox');
            if (resultBox) {
                resultBox.classList.add('show');
            }
        } catch (error) {
            console.error('Error in calculatePayroll:', error);
            alert('An error occurred. Please check the console for details.');
        }
    }

    function calculateROI() {
        try {
            const initialInvestment = parseAmountInput(document.getElementById('roiInitialInvestment').value);
            const finalValue = parseAmountInput(document.getElementById('roiFinalValue').value);
            const years = parseFloat(document.getElementById('roiYears').value) || 1;

            if (initialInvestment <= 0) {
                alert('Please enter a valid initial investment amount.');
                return;
            }

            if (years <= 0) {
                alert('Please enter a valid investment period.');
                return;
            }

            // Calculate net profit
            const netProfit = finalValue - initialInvestment;
            
            // Calculate ROI percentage
            const roiPercent = (netProfit / initialInvestment) * 100;
            
            // Calculate annualized ROI
            const annualizedROI = years > 0 ? (Math.pow(finalValue / initialInvestment, 1 / years) - 1) * 100 : 0;

            // Display results
            document.getElementById('roiNetProfit').innerText = formatNaira(netProfit);
            document.getElementById('roiPercent').innerText = roiPercent.toFixed(2) + '%';
            document.getElementById('roiPercentage').innerText = roiPercent.toFixed(2) + '%';
            document.getElementById('roiAnnualized').innerText = annualizedROI.toFixed(2) + '%';
            document.getElementById('roiTotalReturn').innerText = formatNaira(finalValue);
            
            document.getElementById('roiNetProfitUSD').innerText = formatForeign(netProfit / NGN_TO_USD, 'USD');
            document.getElementById('roiNetProfitGBP').innerText = formatForeign(netProfit / NGN_TO_GBP, 'GBP');
            
            const resultBox = document.getElementById('roiResultBox');
            if (resultBox) {
                resultBox.classList.add('show');
            }
        } catch (error) {
            console.error('Error in calculateROI:', error);
            alert('An error occurred. Please check the console for details.');
        }
    }

    window.onload = function() {
        loadExchangeRates();
        loadCalculatorDefaults();
        
        // Load and apply tool visibility settings
        loadToolVisibility();
        
        // Set minimum month for due date input
        const dueDateInput = document.getElementById('dueDate');
        if (dueDateInput) {
            const nextMonth = new Date();
            nextMonth.setMonth(nextMonth.getMonth() + 1);
            const year = nextMonth.getFullYear();
            const month = String(nextMonth.getMonth() + 1).padStart(2, '0');
            dueDateInput.min = `${year}-${month}`;
        }
        
        // Format all amount inputs on load
        formatAmountInput(document.getElementById('targetAmount'));
        formatAmountInput(document.getElementById('loanAmount'));
        formatAmountInput(document.getElementById('propPrice'));
        formatAmountInput(document.getElementById('downPayment'));
        formatAmountInput(document.getElementById('citTurnover'));
        formatAmountInput(document.getElementById('citAssets'));
        formatAmountInput(document.getElementById('citExpenses'));
        formatAmountInput(document.getElementById('beFixedCosts'));
        formatAmountInput(document.getElementById('beVariableCost'));
        formatAmountInput(document.getElementById('beSellingPrice'));
        formatAmountInput(document.getElementById('cfStartingBalance'));
        formatAmountInput(document.getElementById('cfInflows'));
        formatAmountInput(document.getElementById('cfOutflows'));
        formatAmountInput(document.getElementById('pmRevenue'));
        formatAmountInput(document.getElementById('pmCogs'));
        formatAmountInput(document.getElementById('pmOperatingExpenses'));
        formatAmountInput(document.getElementById('pmOtherExpenses'));
        formatAmountInput(document.getElementById('payrollGrossSalary'));
        formatAmountInput(document.getElementById('payrollRent'));
        formatAmountInput(document.getElementById('payrollInsurance'));
        formatAmountInput(document.getElementById('payrollNHIS'));
        formatAmountInput(document.getElementById('roiInitialInvestment'));
        formatAmountInput(document.getElementById('roiFinalValue'));
        
        // Update loan amount for mortgage calculator
        updateLoanAmount();
        
        // Don't run calculations automatically - only when user clicks calculate button
    };
    
    // Listen for storage changes to update exchange rates and tool visibility in real-time
    window.addEventListener('storage', function(e) {
        if (e.key === 'exchangeRates') {
            loadExchangeRates();
            // Only recalculate if results are already visible (user has clicked calculate)
            const loanResultBox = document.getElementById('loanResultBox');
            const mortgageResultBox = document.getElementById('mortgageResultBox');
            if (loanResultBox && loanResultBox.classList.contains('show')) {
                calculateLoan();
            }
            if (mortgageResultBox && mortgageResultBox.classList.contains('show')) {
                calculateMortgage();
            }
        } else if (e.key === 'calculatorDefaults') {
            loadCalculatorDefaults();
            // Only recalculate if results are already visible (user has clicked calculate)
            const loanResultBox = document.getElementById('loanResultBox');
            const mortgageResultBox = document.getElementById('mortgageResultBox');
            if (loanResultBox && loanResultBox.classList.contains('show')) {
                calculateLoan();
            }
            if (mortgageResultBox && mortgageResultBox.classList.contains('show')) {
                calculateMortgage();
            }
        } else if (e.key === 'toolVisibility') {
            // Reload tool visibility when changed in admin dashboard
            loadToolVisibility();
        }
    });
    
    // Also listen for custom storage events (for same-tab updates)
    window.addEventListener('customStorageChange', function(e) {
        if (e.detail && e.detail.key === 'toolVisibility') {
            loadToolVisibility();
        }
    });
</script>
<script src="js/common.js"></script>

<footer>
    <div class="container">
        <div class="footer-grid">
            <div>
                <h3>Enterprise Room Business Hub</h3>
                <p>Empowering entrepreneurs with resources, networks, and tools to scale and succeed.</p>
            </div>
            <div>
                <h4>Quick Links</h4>
                <ul>
                    <li><a href="index.html">Home</a></li>
                    <li><a href="eventspage.html">Events</a></li>
                    <li><a href="blog.html">Blog</a></li>
                    <li><a href="directories.html">Directories</a></li>
                </ul>
            </div>
            <div>
                <h4>Resources</h4>
                <ul>
                    <li><a href="tools.html">Financial Tools</a></li>
                    <li><a href="pitch.html">Pitch Competition</a></li>
                    <li><a href="profile.html">My Profile</a></li>
                    <li><a href="about.html">About Us</a></li>
                </ul>
            </div>
            <div>
                <h4>Contact</h4>
                <p>
                    <a href="contact.html">Contact Us</a><br>
                    <a href="faq.html">FAQ</a>
                </p>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2026 Enterprise Room Business Hub. All Rights Reserved.</p>
        </div>
    </div>
</footer>

</body>
</html>
