<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Financial Calculators | Enterprise Room Business Hub</title>
    <link rel="icon" type="image/jpeg" href="assets/logo.jpg">
    <script>
        // Check authentication before page loads
        (function() {
            if (sessionStorage.getItem('userAuthenticated') !== 'true') {
                sessionStorage.setItem('redirectAfterLogin', 'tools.html');
                window.location.replace('login.html');
                return;
            }
        })();
    </script>
    <link rel="stylesheet" href="css/styles.css">
    <style>
        /* Page-specific styles */
        .container {
            max-width: 1600px;
        }

        .header-section {
            text-align: center;
            margin-bottom: 30px;
        }

        .tools-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 25px;
            margin-bottom: 20px;
            align-items: start;
        }

        .tool-card {
            background: #f5fbff;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
            border: 1px solid #d0e8ff;
            display: flex;
            flex-direction: column;
            height: 100%;
            min-width: 0;
            overflow-x: visible;
        }

        .tool-card .input-group {
            flex-shrink: 0;
        }

        .tool-card .btn-calc {
            flex-shrink: 0;
        }

        .tool-card .result-box {
            flex-shrink: 0;
        }

        .tool-card h2 {
            margin-top: 0;
            border-bottom: 2px solid var(--light);
            padding-bottom: 8px;
            font-size: 1.2rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .tool-card h2 .info-icon {
            position: relative;
            display: inline-block;
            cursor: help;
            flex-shrink: 0;
        }

        .tool-card h2 .info-icon .tooltip {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            margin-bottom: 5px;
            padding: 8px 12px;
            background: var(--text);
            color: var(--white);
            border-radius: 6px;
            font-size: 0.75rem;
            white-space: normal;
            width: 200px;
            text-align: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
            z-index: 1000;
        }

        .tool-card h2 .info-icon:hover .tooltip {
            opacity: 1;
        }

        .tool-card .input-group {
            margin-bottom: 12px;
        }

        .tool-card .input-group label {
            font-size: 0.85rem;
            margin-bottom: 5px;
        }

        .tool-card .input-group input {
            padding: 10px;
            font-size: 0.9rem;
        }

        .result-box {
            margin-top: 15px;
            padding: 15px;
            background: #ebf8ff;
            border-radius: 8px;
            text-align: center;
            border: 1px solid #bee3f8;
            flex-shrink: 0;
            min-width: 0;
            overflow-x: visible;
            width: 100%;
            box-sizing: border-box;
        }

        .result-box[style*="display: none"] {
            display: none !important;
            margin: 0;
            padding: 0;
            height: 0;
            overflow: hidden;
        }

        .result-label {
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text);
            margin-bottom: 5px;
        }

        .result-val {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary);
        }

        .conversion-box {
            margin-top: 10px;
            font-size: 0.8rem;
            color: var(--text-light);
            border-top: 1px dashed #cbd5e0;
            padding-top: 10px;
        }

        .result-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 15px;
            flex-wrap: wrap;
        }

        .result-main {
            flex: 1;
            min-width: 200px;
        }

        .result-conversion {
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        @media (max-width: 1400px) {
            .tools-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 15px;
            }
        }
        
        @media (max-width: 1200px) {
            .tools-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
            }
            .tool-card {
                padding: 15px;
            }
        }

        @media (max-width: 768px) {
            .tools-grid {
                grid-template-columns: 1fr;
            }
        }

        .currency-item {
            display: inline-block;
            margin: 0 10px;
            font-weight: 600;
            color: var(--text);
        }

        .btn-calc {
            width: 100%;
            padding: 12px;
            background: var(--primary);
            color: var(--white);
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            font-size: 0.9rem;
            margin-top: 0;
            transition: background 0.2s;
        }

        .btn-calc:hover {
            background: var(--accent);
        }

        .budget-result-box {
            background-color: #f0fff4;
            border-color: #c6f6d5;
        }

        .budget-result-val {
            color: var(--success);
        }
    </style>
</head>
<body>

<nav>
    <a href="index.html" class="logo">
        <img src="assets/logo.jpg" alt="Enterprise Room Business Hub Logo" style="height: 60px; max-width: 200px; width: auto; object-fit: contain;">
        <span>Enterprise Room Business Hub</span>
    </a>
    <ul>
        <li><a href="index.html">Home</a></li>
        <li><a href="eventspage.html">Events</a></li>
        <li><a href="blog.html">Blog</a></li>
        <li><a href="tools.html">Tools</a></li>
        <li><a href="pitch.html" class="btn-primary-link">Pitch Competition</a></li>
        <li><a href="directories.html" class="btn-primary-link">Directories</a></li>
        <li><a href="profile.html" class="btn-profile"><span class="nav-avatar-text">My Profile</span></a></li>
    </ul>
</nav>

<div class="breadcrumbs">
    <a href="index.html">Home</a>
    <span>/</span>
    <span>Financial Calculators</span>
</div>

<div class="container">
    <div class="header-section">
        <h1>Financial Planning Calculators</h1>
        <p>Analyze your business and property investments with current Nigerian Naira (₦) premises.</p>
        <div style="margin-top: 20px; display: flex; gap: 10px; flex-wrap: wrap;">
            <button onclick="saveAllCalculations()" class="btn btn-primary" style="padding: 10px 20px;">Save All Calculations</button>
            <button onclick="exportResults()" class="btn btn-success" style="padding: 10px 20px;">Export Results</button>
            <button onclick="printResults()" class="btn" style="padding: 10px 20px; background: var(--white); border: 1px solid var(--border);">Print</button>
        </div>
    </div>

    <div class="tools-grid">
        <div class="tool-card">
            <h2>Budgeting Calculator</h2>
            <div class="input-group">
                <label>Target Type</label>
                <select id="targetType" style="width: 100%; padding: 10px; font-size: 0.9rem; border: 1px solid var(--border); border-radius: 5px; background: var(--white);">
                    <option value="event">Event Amount Target</option>
                    <option value="savings">Savings Amount Target</option>
                    <option value="school">School Fees Amount Target</option>
                    <option value="holiday">Holiday Amount Target</option>
                </select>
            </div>
            <div class="input-group">
                <label>Target Amount (₦)</label>
                <input type="text" id="targetAmount" value="500,000.00" onblur="formatAmountInput(this)" onfocus="this.value = this.value.replace(/,/g, '')" placeholder="Enter target amount">
            </div>
            <div class="input-group">
                <label>
                    Target Month/Year
                    <span style="position: relative; display: inline-block; margin-left: 5px; cursor: help;">
                        <span style="color: var(--accent); font-size: 1rem;">ℹ️</span>
                        <span style="position: absolute; bottom: 100%; left: 50%; transform: translateX(-50%); margin-bottom: 5px; padding: 8px 12px; background: var(--text); color: var(--white); border-radius: 6px; font-size: 0.75rem; white-space: nowrap; opacity: 0; pointer-events: none; transition: opacity 0.3s; z-index: 1000; width: 200px; text-align: center;">Select the month and year when you want to meet your target</span>
                    </span>
                </label>
                <input type="month" id="dueDate" style="width: 100%; padding: 10px; font-size: 0.9rem; border: 1px solid var(--border); border-radius: 5px;">
            </div>
            <button class="btn-calc" onclick="calculateSavingsTarget()">Calculate Monthly Budget</button>
            <div class="result-box budget-result-box" id="savingsResultBox" style="display: none;">
                <div class="result-row">
                    <div class="result-main">
                        <div class="result-label">Monthly Savings Required</div>
                        <div class="result-val budget-result-val" id="savingsResult">₦0.00</div>
                    </div>
                    <div class="result-conversion">
                        <span class="currency-item" id="savingsUSD">$0.00</span>
                        <span class="currency-item" id="savingsGBP">£0.00</span>
                    </div>
                </div>
                <div class="conversion-box" style="margin-top: 10px; padding-top: 10px; border-top: 1px dashed #cbd5e0;">
                    <strong>International Equivalents:</strong>
                </div>
                <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid var(--border); text-align: left; width: 100%; box-sizing: border-box; overflow-x: visible;">
                    <div style="font-size: 0.85rem; margin-bottom: 8px; white-space: nowrap; overflow: visible; word-break: keep-all; min-width: fit-content;"><strong>Total budget:</strong> <span id="totalBudgetDisplay">₦0.00</span></div>
                    <div style="font-size: 0.85rem; margin-bottom: 8px; white-space: nowrap; overflow: visible; word-break: keep-all; min-width: fit-content;"><strong>Due date:</strong> <span id="dueDateDisplay">-</span></div>
                    <div style="font-size: 0.85rem; white-space: nowrap; overflow: visible; word-break: keep-all; min-width: fit-content;"><span id="monthsRemaining">0</span> <strong><span id="paymentText">payment</span> of</strong> <span id="monthlyTargetDisplay" style="color: var(--primary); font-weight: bold;">₦0.00</span></div>
                </div>
            </div>
        </div>

        <div class="tool-card">
            <h2>Business Loan Calculator</h2>
            <div class="input-group">
                <label>Loan Amount (₦)</label>
                <input type="text" id="loanAmount" value="5,000,000.00" onblur="formatAmountInput(this)" onfocus="this.value = this.value.replace(/,/g, '')">
            </div>
            <div class="input-group">
                <label>Interest Rate (Annual %)</label>
                <input type="number" id="loanRate" value="22" step="0.1">
            </div>
            <div class="input-group">
                <label>Term (Months)</label>
                <input type="number" id="loanTerm" value="24">
            </div>
            <button class="btn-calc" onclick="calculateLoan()">Calculate Repayment</button>
            <div class="result-box">
                <div class="result-row">
                    <div class="result-main">
                        <div class="result-label">Monthly Repayment</div>
                        <div class="result-val" id="loanResult">₦0.00</div>
                    </div>
                    <div class="result-conversion">
                        <span class="currency-item" id="loanUSD">$0.00</span>
                        <span class="currency-item" id="loanGBP">£0.00</span>
                    </div>
                </div>
                <div class="conversion-box" style="margin-top: 10px; padding-top: 10px; border-top: 1px dashed #cbd5e0;">
                    <strong>International Equivalents:</strong>
                </div>
            </div>
        </div>

        <div class="tool-card">
            <h2>Mortgage Calculator</h2>
            <div class="input-group">
                <label>Property Price (₦)</label>
                <input type="text" id="propPrice" value="45,000,000.00" onblur="formatAmountInput(this); updateLoanAmount();" onfocus="this.value = this.value.replace(/,/g, '')">
            </div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                <div class="input-group">
                    <label>Deposit (₦)</label>
                    <input type="text" id="downPayment" value="9,000,000.00" onblur="formatAmountInput(this); updateLoanAmount();" onfocus="this.value = this.value.replace(/,/g, '')">
                </div>
                <div class="input-group">
                    <label>Loan Amount (₦)</label>
                    <input type="text" id="loanAmountMortgage" value="36,000,000.00" readonly style="background-color: #f5f5f5; cursor: not-allowed;" onblur="formatAmountInput(this)">
                </div>
            </div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                <div class="input-group">
                    <label>Interest Rate (%)</label>
                    <input type="number" id="mortgageRate" value="16">
                </div>
                <div class="input-group">
                    <label>Term (Years)</label>
                    <input type="number" id="mortgageTerm" value="15">
                </div>
            </div>
            <button class="btn-calc" onclick="calculateMortgage()">Calculate Mortgage</button>
            <div class="result-box">
                <div class="result-row">
                    <div class="result-main">
                        <div class="result-label">Estimated Monthly Payment</div>
                        <div class="result-val" id="mortgageResult">₦0.00</div>
                    </div>
                    <div class="result-conversion">
                        <span class="currency-item" id="mortgageUSD">$0.00</span>
                        <span class="currency-item" id="mortgageGBP">£0.00</span>
                    </div>
                </div>
                <div class="conversion-box" style="margin-top: 10px; padding-top: 10px; border-top: 1px dashed #cbd5e0;">
                    <strong>International Equivalents:</strong>
                </div>
            </div>
        </div>

        <div class="tool-card">
            <h2>
                <span style="white-space: nowrap;">PIT Calculator (Nigeria)</span>
                <span class="info-icon">
                    <span style="color: var(--accent); font-size: 1rem;">ℹ️</span>
                    <span class="tooltip">PIT stands for Personal Income Tax. Calculate your personal income tax based on Nigeria's 2026 tax brackets.</span>
                </span>
            </h2>
            <div class="input-group">
                <label>Annual Gross Salary (₦)</label>
                <input type="text" id="annualSalary" value="5,000,000.00" onblur="formatAmountInput(this)" onfocus="this.value = this.value.replace(/,/g, '')" placeholder="Enter your annual salary">
            </div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                <div class="input-group">
                    <label style="white-space: nowrap; display: flex; align-items: center; gap: 5px;">
                        <span>Annual Rent (₦)</span>
                        <span style="position: relative; display: inline-block; cursor: help; flex-shrink: 0;">
                            <span style="color: var(--accent); font-size: 1rem;">ℹ️</span>
                            <span style="position: absolute; bottom: 100%; left: 50%; transform: translateX(-50%); margin-bottom: 5px; padding: 8px 12px; background: var(--text); color: var(--white); border-radius: 6px; font-size: 0.75rem; white-space: normal; opacity: 0; pointer-events: none; transition: opacity 0.3s; z-index: 1000; width: 250px; text-align: center;">The amount you can claim for rent relief is up to but not more than ₦500,000.00</span>
                        </span>
                    </label>
                    <input type="text" id="annualRent" value="0.00" onblur="formatAmountInput(this)" onfocus="this.value = this.value.replace(/,/g, '')" placeholder="Enter annual rent">
                </div>
                <div class="input-group">
                    <label style="white-space: nowrap; display: flex; align-items: center; gap: 5px;">
                        <span>Life Insurance (₦)</span>
                        <span style="position: relative; display: inline-block; cursor: help; flex-shrink: 0;">
                            <span style="color: var(--accent); font-size: 1rem;">ℹ️</span>
                            <span style="position: absolute; bottom: 100%; left: 50%; transform: translateX(-50%); margin-bottom: 5px; padding: 8px 12px; background: var(--text); color: var(--white); border-radius: 6px; font-size: 0.75rem; white-space: normal; opacity: 0; pointer-events: none; transition: opacity 0.3s; z-index: 1000; width: 250px; text-align: center;">The amount you can claim for life insurance is up to but not more than ₦100,000.00</span>
                        </span>
                    </label>
                    <input type="text" id="lifeInsurance" value="0.00" onblur="formatAmountInput(this)" onfocus="this.value = this.value.replace(/,/g, '')" placeholder="Enter insurance premiums">
                </div>
            </div>
            <div class="input-group">
                <label>NHIS Contribution (₦) <small style="color: var(--text-light);">(Optional)</small></label>
                <input type="text" id="nhisContribution" value="0.00" onblur="formatAmountInput(this)" onfocus="this.value = this.value.replace(/,/g, '')" placeholder="Enter NHIS contribution">
            </div>
            <button class="btn-calc" onclick="calculatePersonalIncomeTax()">Calculate Tax</button>
            <div class="result-box" id="taxResultBox" style="display: none;">
                <div class="result-row">
                    <div class="result-main">
                        <div class="result-label">Annual Tax Payable</div>
                        <div class="result-val" id="taxResult">₦0.00</div>
                    </div>
                    <div class="result-conversion">
                        <span class="currency-item" id="taxUSD">$0.00</span>
                        <span class="currency-item" id="taxGBP">£0.00</span>
                    </div>
                </div>
                <div class="conversion-box" style="margin-top: 10px; padding-top: 10px; border-top: 1px dashed #cbd5e0;">
                    <strong>International Equivalents:</strong>
                </div>
                <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid var(--border); text-align: left;">
                    <div style="font-size: 0.85rem; margin-bottom: 8px; display: flex; align-items: center; gap: 5px;">
                        <strong>Calculation Breakdown</strong>
                        <span style="position: relative; display: inline-block; cursor: help; flex-shrink: 0;">
                            <span style="color: var(--accent); font-size: 1rem;">ℹ️</span>
                            <span style="position: absolute; bottom: 100%; left: 50%; transform: translateX(-50%); margin-bottom: 5px; padding: 15px; background: var(--text); color: var(--white); border-radius: 8px; font-size: 0.9rem; white-space: normal; opacity: 0; pointer-events: none; transition: opacity 0.3s; z-index: 1000; width: 380px; text-align: left; line-height: 1.8; font-weight: 400; box-shadow: 0 4px 12px rgba(0,0,0,0.3);">
                                <strong style="display: block; margin-bottom: 12px; text-align: center; font-size: 1rem; color: var(--white); border-bottom: 1px solid rgba(255,255,255,0.3); padding-bottom: 8px;">Tax Calculation Example</strong>
                                <div style="margin-bottom: 10px;"><strong style="font-size: 0.95rem;">Example: Annual Salary ₦3,000,000, Rent ₦500,000</strong></div>
                                <div style="margin-bottom: 10px;"><strong>Deductions:</strong><br>
                                • Pension (8%): ₦240,000<br>
                                • NHF (2.5%): ₦75,000<br>
                                • Rent Relief (20%): ₦100,000<br>
                                • Total Deductions: ₦415,000</div>
                                <div style="margin-bottom: 10px;"><strong>Taxable Income:</strong> ₦3,000,000 - ₦415,000 = ₦2,585,000</div>
                                <div style="margin-bottom: 10px;"><strong>Tax Calculation:</strong><br>
                                • First ₦800,000: ₦0 (tax-free)<br>
                                • ₦800,001 - ₦3,000,000 (15%): (₦2,585,000 - ₦800,000) × 15% = ₦267,750</div>
                                <div style="margin-top: 12px; padding-top: 10px; border-top: 1px solid rgba(255,255,255,0.3);">
                                    <strong style="font-size: 0.95rem;">Annual Tax: ₦267,750</strong><br>
                                    <strong style="font-size: 0.95rem;">Monthly Tax: ₦22,312.50</strong>
                                </div>
                            </span>
                        </span>
                    </div>
                    <div style="font-size: 0.85rem; margin-bottom: 8px;"><strong>Monthly Tax:</strong> <span id="monthlyTax">₦0.00</span></div>
                    <div style="font-size: 0.85rem; margin-bottom: 8px;"><strong>Taxable Income:</strong> <span id="taxableIncome">₦0.00</span></div>
                    <div style="font-size: 0.85rem; margin-bottom: 8px;"><strong>Total Deductions:</strong> <span id="totalDeductions">₦0.00</span></div>
                    <div style="font-size: 0.85rem; margin-bottom: 8px;"><strong>Net Income After Tax:</strong> <span id="netIncome" style="color: var(--success); font-weight: bold;">₦0.00</span></div>
                    <div style="font-size: 0.85rem;"><strong>Effective Tax Rate:</strong> <span id="effectiveTaxRate">0%</span></div>
                </div>
            </div>
        </div>
        
        <!-- Custom Tools will be loaded here dynamically -->
        <div id="customToolsContainer"></div>
    </div>
</div>

<script src="js/common.js"></script>
<script>
    // Currency Exchange Rates - Load from localStorage or use defaults
    let NGN_TO_USD = 1450;
    let NGN_TO_GBP = 1850;
    
    // Load exchange rates from localStorage (set by admin)
    function loadExchangeRates() {
        const savedRates = JSON.parse(localStorage.getItem('exchangeRates') || '{}');
        if (savedRates.usd) {
            NGN_TO_USD = parseFloat(savedRates.usd) || 1450;
        }
        if (savedRates.gbp) {
            NGN_TO_GBP = parseFloat(savedRates.gbp) || 1850;
        }
        console.log('Loaded exchange rates:', { USD: NGN_TO_USD, GBP: NGN_TO_GBP });
    }
    
    // Load calculator defaults from localStorage (set by admin)
    function loadCalculatorDefaults() {
        const defaults = JSON.parse(localStorage.getItem('calculatorDefaults') || '{}');
        
        // Load loan calculator defaults
        if (defaults.loanRate) {
            const loanRateInput = document.getElementById('loanRate');
            if (loanRateInput) loanRateInput.value = defaults.loanRate;
        }
        if (defaults.loanTerm) {
            const loanTermInput = document.getElementById('loanTerm');
            if (loanTermInput) loanTermInput.value = defaults.loanTerm;
        }
        
        // Load mortgage calculator defaults
        if (defaults.mortgageRate) {
            const mortgageRateInput = document.getElementById('mortgageRate');
            if (mortgageRateInput) mortgageRateInput.value = defaults.mortgageRate;
        }
        if (defaults.mortgageTerm) {
            const mortgageTermInput = document.getElementById('mortgageTerm');
            if (mortgageTermInput) mortgageTermInput.value = defaults.mortgageTerm;
        }
        
        // Load tax rate default
        if (defaults.taxRate) {
            const taxInput = document.getElementById('tax');
            if (taxInput) taxInput.value = defaults.taxRate;
        }
        
        console.log('Loaded calculator defaults:', defaults);
    }
    
    // Initialize exchange rates on load
    loadExchangeRates();

    // Helper function to parse formatted amount input (removes commas)
    function parseAmountInput(value) {
        return parseFloat(value.toString().replace(/,/g, '')) || 0;
    }

    // Helper function to format amount input with commas and 2 decimal places
    function formatAmountInput(input) {
        let value = input.value.replace(/,/g, '');
        if (value === '' || isNaN(value)) {
            input.value = '0.00';
            return;
        }
        let num = parseFloat(value);
        if (isNaN(num)) {
            input.value = '0.00';
            return;
        }
        input.value = num.toLocaleString('en-US', {
            minimumFractionDigits: 2,
            maximumFractionDigits: 2
        });
    }

    // Helper function to format numbers as Naira
    function formatNaira(amount) {
        return '₦' + parseFloat(amount).toLocaleString('en-NG', {
            minimumFractionDigits: 2,
            maximumFractionDigits: 2
        });
    }

    // Helper function for $ and £
    function formatForeign(amount, currency) {
        const symbols = { 'USD': '$', 'GBP': '£' };
        return symbols[currency] + parseFloat(amount).toLocaleString('en-US', {
            minimumFractionDigits: 2,
            maximumFractionDigits: 2
        });
    }

    function calculateLoan() {
        const P = parseAmountInput(document.getElementById('loanAmount').value);
        const r = (parseFloat(document.getElementById('loanRate').value) / 100) / 12;
        const n = parseFloat(document.getElementById('loanTerm').value);

        let monthly;
        if (r === 0) {
            monthly = P / n;
        } else {
            monthly = (P * r * Math.pow(1 + r, n)) / (Math.pow(1 + r, n) - 1);
        }
        
        document.getElementById('loanResult').innerText = formatNaira(monthly);
        document.getElementById('loanUSD').innerText = formatForeign(monthly / NGN_TO_USD, 'USD');
        document.getElementById('loanGBP').innerText = formatForeign(monthly / NGN_TO_GBP, 'GBP');
    }

    function updateLoanAmount() {
        const price = parseAmountInput(document.getElementById('propPrice').value);
        const down = parseAmountInput(document.getElementById('downPayment').value);
        const loanAmount = price - down;
        const loanAmountInput = document.getElementById('loanAmountMortgage');
        loanAmountInput.value = loanAmount.toLocaleString('en-US', {
            minimumFractionDigits: 2,
            maximumFractionDigits: 2
        });
    }

    function calculateMortgage() {
        const price = parseAmountInput(document.getElementById('propPrice').value);
        const down = parseAmountInput(document.getElementById('downPayment').value);
        const P = price - down;
        const r = (parseFloat(document.getElementById('mortgageRate').value) / 100) / 12;
        const n = parseFloat(document.getElementById('mortgageTerm').value) * 12;

        if (r === 0) {
            const monthly = P / n;
            document.getElementById('mortgageResult').innerText = formatNaira(monthly);
            document.getElementById('mortgageUSD').innerText = formatForeign(monthly / NGN_TO_USD, 'USD');
            document.getElementById('mortgageGBP').innerText = formatForeign(monthly / NGN_TO_GBP, 'GBP');
            return;
        }

        const monthly = (P * r * Math.pow(1 + r, n)) / (Math.pow(1 + r, n) - 1);
        
        // Update UI
        document.getElementById('mortgageResult').innerText = formatNaira(monthly);
        document.getElementById('mortgageUSD').innerText = formatForeign(monthly / NGN_TO_USD, 'USD');
        document.getElementById('mortgageGBP').innerText = formatForeign(monthly / NGN_TO_GBP, 'GBP');
    }

    function calculateBudget() {
        // Legacy function - kept for backward compatibility if needed
        // This is now replaced by calculateSavingsTarget()
    }

    function calculateSavingsTarget() {
        const targetType = document.getElementById('targetType').value;
        const targetAmount = parseAmountInput(document.getElementById('targetAmount').value);
        const dueDateInput = document.getElementById('dueDate').value;

        // Validate inputs
        if (targetAmount <= 0) {
            alert('Please enter a valid target amount.');
            return;
        }

        if (!dueDateInput) {
            alert('Please select a target month/year.');
            return;
        }

        // Parse month/year input (format: YYYY-MM)
        const [year, month] = dueDateInput.split('-');
        const dueDate = new Date(parseInt(year), parseInt(month) - 1, 1); // First day of target month
        const today = new Date();
        today.setHours(0, 0, 0, 0);
        const todayMonth = new Date(today.getFullYear(), today.getMonth(), 1); // First day of current month

        // Check if target month is in the future
        if (dueDate <= todayMonth) {
            alert('Target month must be in the future. Please select a future month.');
            return;
        }

        // Calculate months remaining (from start of current month to start of target month)
        const monthsRemaining = (dueDate.getFullYear() - todayMonth.getFullYear()) * 12 + 
                                (dueDate.getMonth() - todayMonth.getMonth());
        
        if (monthsRemaining <= 0) {
            alert('Invalid month calculation. Please check your target month.');
            return;
        }

        // Calculate monthly savings required
        const monthlySavings = targetAmount / monthsRemaining;

        // Format target type display
        const targetTypeNames = {
            'event': 'Event Amount Target',
            'savings': 'Savings Amount Target',
            'school': 'School Fees Amount Target',
            'holiday': 'Holiday Amount Target'
        };

        // Format month/year for display (e.g., "January 2027")
        const formattedDate = dueDate.toLocaleDateString('en-US', { 
            year: 'numeric', 
            month: 'long'
        });

        // Display results
        document.getElementById('savingsResult').innerText = formatNaira(monthlySavings);
        document.getElementById('totalBudgetDisplay').innerText = formatNaira(targetAmount);
        document.getElementById('dueDateDisplay').innerText = formattedDate;
        document.getElementById('monthlyTargetDisplay').innerText = formatNaira(monthlySavings);
        document.getElementById('monthsRemaining').innerText = monthsRemaining;
        document.getElementById('paymentText').innerText = monthsRemaining === 1 ? 'payment' : 'payments';
        
        // International equivalents
        document.getElementById('savingsUSD').innerText = formatForeign(monthlySavings / NGN_TO_USD, 'USD');
        document.getElementById('savingsGBP').innerText = formatForeign(monthlySavings / NGN_TO_GBP, 'GBP');
        
        // Show result box
        document.getElementById('savingsResultBox').style.display = 'block';
    }

    function calculatePersonalIncomeTax() {
        // Get inputs
        const grossSalary = parseAmountInput(document.getElementById('annualSalary').value);
        const annualRent = parseAmountInput(document.getElementById('annualRent').value);
        const lifeInsurance = parseAmountInput(document.getElementById('lifeInsurance').value);
        const nhisContribution = parseAmountInput(document.getElementById('nhisContribution').value);

        if (grossSalary <= 0) {
            alert('Please enter a valid annual salary.');
            return;
        }

        // Calculate allowable deductions
        // Pension: 8% of gross income
        const pensionContribution = grossSalary * 0.08;
        
        // NHF: 2.5% of gross income
        const nhfContribution = grossSalary * 0.025;
        
        // Life Insurance: Up to ₦100,000
        const lifeInsuranceDeduction = Math.min(lifeInsurance, 100000);
        
        // Rent Relief: 20% of annual rent, capped at ₦500,000
        const rentRelief = Math.min(annualRent * 0.20, 500000);
        
        // NHIS: User-specified
        const nhisDeduction = nhisContribution;
        
        // Total deductions
        const totalDeductions = pensionContribution + nhfContribution + lifeInsuranceDeduction + rentRelief + nhisDeduction;
        
        // Taxable income (gross salary minus deductions)
        const taxableIncome = Math.max(0, grossSalary - totalDeductions);
        
        // Calculate tax using progressive brackets (2026 Nigeria Tax Law)
        // First ₦800,000 is tax-free (0%)
        let totalTax = 0;
        
        if (taxableIncome <= 800000) {
            // First ₦800,000 is completely tax-free
            totalTax = 0;
        } else {
            // Progressive tax brackets (2026 rates)
            // Each bracket is taxed only on the amount within that bracket
            
            // ₦800,001 to ₦3,000,000: 15%
            if (taxableIncome > 3000000) {
                totalTax += (3000000 - 800000) * 0.15; // Full bracket
            } else {
                totalTax += (taxableIncome - 800000) * 0.15; // Partial bracket
            }
            
            // ₦3,000,001 to ₦12,000,000: 18%
            if (taxableIncome > 12000000) {
                totalTax += (12000000 - 3000000) * 0.18; // Full bracket
            } else if (taxableIncome > 3000000) {
                totalTax += (taxableIncome - 3000000) * 0.18; // Partial bracket
            }
            
            // ₦12,000,001 to ₦25,000,000: 21%
            if (taxableIncome > 25000000) {
                totalTax += (25000000 - 12000000) * 0.21; // Full bracket
            } else if (taxableIncome > 12000000) {
                totalTax += (taxableIncome - 12000000) * 0.21; // Partial bracket
            }
            
            // ₦25,000,001 to ₦50,000,000: 23%
            if (taxableIncome > 50000000) {
                totalTax += (50000000 - 25000000) * 0.23; // Full bracket
            } else if (taxableIncome > 25000000) {
                totalTax += (taxableIncome - 25000000) * 0.23; // Partial bracket
            }
            
            // Above ₦50,000,000: 25%
            if (taxableIncome > 50000000) {
                totalTax += (taxableIncome - 50000000) * 0.25; // Partial bracket
            }
        }
        
        // Calculate results
        const monthlyTax = totalTax / 12;
        const netIncome = grossSalary - totalTax;
        const effectiveTaxRate = grossSalary > 0 ? (totalTax / grossSalary) * 100 : 0;
        
        // Display results
        document.getElementById('taxResult').innerText = formatNaira(totalTax);
        document.getElementById('monthlyTax').innerText = formatNaira(monthlyTax);
        document.getElementById('taxableIncome').innerText = formatNaira(taxableIncome);
        document.getElementById('totalDeductions').innerText = formatNaira(totalDeductions);
        document.getElementById('netIncome').innerText = formatNaira(netIncome);
        document.getElementById('effectiveTaxRate').innerText = effectiveTaxRate.toFixed(2) + '%';
        
        // International equivalents
        document.getElementById('taxUSD').innerText = formatForeign(totalTax / NGN_TO_USD, 'USD');
        document.getElementById('taxGBP').innerText = formatForeign(totalTax / NGN_TO_GBP, 'GBP');
        
        // Show result box
        document.getElementById('taxResultBox').style.display = 'block';
    }

    // Load custom tools from localStorage
    function loadCustomTools() {
        const customTools = JSON.parse(localStorage.getItem('customTools') || '[]');
        const container = document.getElementById('customToolsContainer');
        
        if (!container || customTools.length === 0) {
            return;
        }
        
        // Create a new grid for custom tools
        const customGrid = document.createElement('div');
        customGrid.className = 'tools-grid';
        customGrid.style.marginTop = '30px';
        
        customTools.forEach(tool => {
            const toolCard = document.createElement('div');
            toolCard.className = 'tool-card';
            toolCard.setAttribute('data-tool-id', tool.id);
            
            // Build HTML for tool card
            let inputsHTML = '';
            tool.inputs.forEach(input => {
                const onblurAttr = input.type === 'amount' ? 'onblur="formatAmountInput(this)" onfocus="this.value = this.value.replace(/,/g, \'\')"' : '';
                const inputType = input.type === 'amount' ? 'text' : input.type || 'number';
                inputsHTML += `
                    <div class="input-group">
                        <label>${input.label}</label>
                        <input type="${inputType}" id="${input.id}" value="${input.value || ''}" ${onblurAttr}>
                    </div>
                `;
            });
            
            const resultBoxClass = tool.resultColor === 'success' ? 'result-box budget-result-box' : 'result-box';
            const resultValClass = tool.resultColor === 'success' ? 'result-val budget-result-val' : 'result-val';
            
            let conversionHTML = '';
            if (tool.showConversion) {
                conversionHTML = `
                    <div class="conversion-box">
                        <strong>International Equivalents:</strong><br>
                        <span class="currency-item" id="${tool.resultId}USD">$0.00</span>
                        <span class="currency-item" id="${tool.resultId}GBP">£0.00</span>
                    </div>
                `;
            }
            
            toolCard.innerHTML = `
                <h2>${tool.name}</h2>
                ${tool.description ? `<p style="font-size: 0.85rem; color: var(--text-light); margin-bottom: 15px;">${tool.description}</p>` : ''}
                ${inputsHTML}
                <button class="btn-calc" style="background-color: ${tool.buttonColor};" onclick="executeCustomTool('${tool.id}')">${tool.buttonText}</button>
                <div class="${resultBoxClass}">
                    <div class="result-label">${tool.resultLabel}</div>
                    <div class="${resultValClass}" id="${tool.resultId}">₦0.00</div>
                    ${conversionHTML}
                </div>
            `;
            
            customGrid.appendChild(toolCard);
            
            // Store tool data for execution
            if (!window.customToolsData) {
                window.customToolsData = {};
            }
            window.customToolsData[tool.id] = tool;
        });
        
        container.appendChild(customGrid);
    }
    
    // Execute custom tool calculation
    function executeCustomTool(toolId) {
        if (!window.customToolsData || !window.customToolsData[toolId]) {
            alert('Tool not found.');
            return;
        }
        
        const tool = window.customToolsData[toolId];
        
        try {
            // Create a function that has access to all helper functions
            const funcCode = `
                (function() {
                    ${tool.function}
                })();
            `;
            
            // Execute the function
            eval(funcCode);
            
            // If conversion is enabled, update conversion values
            if (tool.showConversion) {
                const resultElement = document.getElementById(tool.resultId);
                if (resultElement) {
                    const resultText = resultElement.innerText;
                    // Extract numeric value from result (remove currency symbols and commas)
                    const numericValue = parseFloat(resultText.replace(/[₦$,£,\s]/g, '')) || 0;
                    
                    const usdElement = document.getElementById(tool.resultId + 'USD');
                    const gbpElement = document.getElementById(tool.resultId + 'GBP');
                    
                    if (usdElement && !isNaN(numericValue)) {
                        usdElement.innerText = formatForeign(numericValue / NGN_TO_USD, 'USD');
                    }
                    if (gbpElement && !isNaN(numericValue)) {
                        gbpElement.innerText = formatForeign(numericValue / NGN_TO_GBP, 'GBP');
                    }
                }
            }
        } catch (error) {
            console.error('Error executing tool calculation:', error);
            alert('Error calculating result: ' + error.message + '. Please check the console for details.');
        }
    }
    
    // Run calculations once on load so the screen isn't empty
    // Set minimum month for due date input and initialize tooltip
    function initializeSavingsTargetTool() {
        const dueDateInput = document.getElementById('dueDate');
        if (dueDateInput) {
            const nextMonth = new Date();
            nextMonth.setMonth(nextMonth.getMonth() + 1);
            const year = nextMonth.getFullYear();
            const month = String(nextMonth.getMonth() + 1).padStart(2, '0');
            dueDateInput.min = `${year}-${month}`;
        }
        
        // Initialize info icon tooltip
        const infoIcon = document.querySelector('label span[style*="cursor: help"]');
        if (infoIcon) {
            const tooltip = infoIcon.querySelector('span[style*="position: absolute"]');
            if (tooltip) {
                infoIcon.addEventListener('mouseenter', function() {
                    tooltip.style.opacity = '1';
                });
                infoIcon.addEventListener('mouseleave', function() {
                    tooltip.style.opacity = '0';
                });
            }
        }
    }

    function initializeTaxCalculatorTooltips() {
        // Initialize Annual Rent tooltip
        const rentInput = document.getElementById('annualRent');
        if (rentInput) {
            const rentLabel = rentInput.previousElementSibling;
            if (rentLabel) {
                const rentInfoIcon = rentLabel.querySelector('span[style*="cursor: help"]');
                if (rentInfoIcon) {
                    const rentTooltip = rentInfoIcon.querySelector('span[style*="position: absolute"]');
                    if (rentTooltip) {
                        rentInfoIcon.addEventListener('mouseenter', function() {
                            rentTooltip.style.opacity = '1';
                        });
                        rentInfoIcon.addEventListener('mouseleave', function() {
                            rentTooltip.style.opacity = '0';
                        });
                    }
                }
            }
        }
        
        // Initialize Life Insurance tooltip
        const insuranceInput = document.getElementById('lifeInsurance');
        if (insuranceInput) {
            const insuranceLabel = insuranceInput.previousElementSibling;
            if (insuranceLabel) {
                const insuranceInfoIcon = insuranceLabel.querySelector('span[style*="cursor: help"]');
                if (insuranceInfoIcon) {
                    const insuranceTooltip = insuranceInfoIcon.querySelector('span[style*="position: absolute"]');
                    if (insuranceTooltip) {
                        insuranceInfoIcon.addEventListener('mouseenter', function() {
                            insuranceTooltip.style.opacity = '1';
                        });
                        insuranceInfoIcon.addEventListener('mouseleave', function() {
                            insuranceTooltip.style.opacity = '0';
                        });
                    }
                }
            }
        }
        
        // Initialize Calculation Breakdown tooltip
        const breakdownInfoIcon = document.querySelector('#taxResultBox span[style*="cursor: help"]');
        if (breakdownInfoIcon) {
            const breakdownTooltip = breakdownInfoIcon.querySelector('span[style*="position: absolute"]');
            if (breakdownTooltip) {
                breakdownInfoIcon.addEventListener('mouseenter', function() {
                    breakdownTooltip.style.opacity = '1';
                });
                breakdownInfoIcon.addEventListener('mouseleave', function() {
                    breakdownTooltip.style.opacity = '0';
                });
            }
        }
    }

    window.onload = function() {
        initializeSavingsTargetTool();
        initializeTaxCalculatorTooltips();
        // Load exchange rates and calculator defaults from localStorage
        loadExchangeRates();
        loadCalculatorDefaults();
        
        // Format all amount inputs on load
        const targetAmountInput = document.getElementById('targetAmount');
        if (targetAmountInput) {
            formatAmountInput(targetAmountInput);
        }
        formatAmountInput(document.getElementById('loanAmount'));
        formatAmountInput(document.getElementById('propPrice'));
        formatAmountInput(document.getElementById('downPayment'));
        
        // Update loan amount for mortgage calculator
        updateLoanAmount();
        
        calculateLoan();
        calculateMortgage();
        
        // Initialize savings target tool (target month min and tooltip)
        const dueDateInput = document.getElementById('dueDate');
        if (dueDateInput) {
            const nextMonth = new Date();
            nextMonth.setMonth(nextMonth.getMonth() + 1);
            const year = nextMonth.getFullYear();
            const month = String(nextMonth.getMonth() + 1).padStart(2, '0');
            dueDateInput.min = `${year}-${month}`;
        }
        
        // Initialize info icon tooltip
        const infoIcon = document.querySelector('label span[style*="cursor: help"]');
        if (infoIcon) {
            const tooltip = infoIcon.querySelector('span[style*="position: absolute"]');
            if (tooltip) {
                infoIcon.addEventListener('mouseenter', function() {
                    tooltip.style.opacity = '1';
                });
                infoIcon.addEventListener('mouseleave', function() {
                    tooltip.style.opacity = '0';
                });
            }
        }
        
        // Load custom tools
        loadCustomTools();
    };
    
    // Listen for storage changes to update exchange rates in real-time
    window.addEventListener('storage', function(e) {
        if (e.key === 'exchangeRates') {
            loadExchangeRates();
            // Recalculate all results with new rates
            calculateLoan();
            calculateMortgage();
            calculateBudget();
        } else if (e.key === 'calculatorDefaults') {
            loadCalculatorDefaults();
            // Recalculate with new defaults
            calculateLoan();
            calculateMortgage();
            calculateBudget();
        }
    });
    
    // Save calculations to localStorage
    function saveAllCalculations() {
        const calculations = {
            budget: {
                revenue: document.getElementById('revenue').value,
                expenses: document.getElementById('expenses').value,
                tax: document.getElementById('tax').value,
                result: document.getElementById('budgetResult').innerText
            },
            loan: {
                amount: document.getElementById('loanAmount').value,
                rate: document.getElementById('loanRate').value,
                term: document.getElementById('loanTerm').value,
                result: document.getElementById('loanResult').innerText
            },
            mortgage: {
                price: document.getElementById('propPrice').value,
                deposit: document.getElementById('downPayment').value,
                rate: document.getElementById('mortgageRate').value,
                term: document.getElementById('mortgageTerm').value,
                result: document.getElementById('mortgageResult').innerText
            },
            timestamp: new Date().toISOString()
        };
        
        localStorage.setItem('savedCalculations', JSON.stringify(calculations));
        alert('Calculations saved successfully!');
    }
    
    // Export results as text
    function exportResults() {
        const results = `Financial Planning Calculator Results\nGenerated: ${new Date().toLocaleString()}\n\nBUDGETING CALCULATOR\nMonthly Revenue: ${document.getElementById('revenue').value}\nOperating Expenses: ${document.getElementById('expenses').value}\nTax Rate: ${document.getElementById('tax').value}%\nResult: ${document.getElementById('budgetResult').innerText}\n\nBUSINESS LOAN CALCULATOR\nLoan Amount: ${document.getElementById('loanAmount').value}\nInterest Rate: ${document.getElementById('loanRate').value}%\nTerm: ${document.getElementById('loanTerm').value} months\nResult: ${document.getElementById('loanResult').innerText}\n\nMORTGAGE CALCULATOR\nProperty Price: ${document.getElementById('propPrice').value}\nDeposit: ${document.getElementById('downPayment').value}\nInterest Rate: ${document.getElementById('mortgageRate').value}%\nTerm: ${document.getElementById('mortgageTerm').value} years\nResult: ${document.getElementById('mortgageResult').innerText}`;
        
        const blob = new Blob([results], { type: 'text/plain' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `calculations-${new Date().toISOString().split('T')[0]}.txt`;
        a.click();
        URL.revokeObjectURL(url);
    }
    
    // Print results
    function printResults() {
        const printWindow = window.open('', '_blank');
        printWindow.document.write(`<html><head><title>Financial Calculator Results</title><style>body{font-family:Arial,sans-serif;padding:20px}h1{color:#1a365d}.result-section{margin:20px 0;padding:15px;border:1px solid #ddd}</style></head><body><h1>Financial Planning Calculator Results</h1><p>Generated: ${new Date().toLocaleString()}</p><div class="result-section"><h2>Budgeting Calculator</h2><p>Monthly Revenue: ${document.getElementById('revenue').value}</p><p>Operating Expenses: ${document.getElementById('expenses').value}</p><p>Tax Rate: ${document.getElementById('tax').value}%</p><p><strong>Result: ${document.getElementById('budgetResult').innerText}</strong></p></div><div class="result-section"><h2>Business Loan Calculator</h2><p>Loan Amount: ${document.getElementById('loanAmount').value}</p><p>Interest Rate: ${document.getElementById('loanRate').value}%</p><p>Term: ${document.getElementById('loanTerm').value} months</p><p><strong>Result: ${document.getElementById('loanResult').innerText}</strong></p></div><div class="result-section"><h2>Mortgage Calculator</h2><p>Property Price: ${document.getElementById('propPrice').value}</p><p>Deposit: ${document.getElementById('downPayment').value}</p><p>Interest Rate: ${document.getElementById('mortgageRate').value}%</p><p>Term: ${document.getElementById('mortgageTerm').value} years</p><p><strong>Result: ${document.getElementById('mortgageResult').innerText}</strong></p></div></body></html>`);
        printWindow.document.close();
        printWindow.print();
    }
</script>

<footer>
    <div class="container">
        <div class="footer-grid">
            <div>
                <h3>Enterprise Room Business Hub</h3>
                <p>Empowering entrepreneurs with resources, networks, and tools to scale and succeed.</p>
            </div>
            <div>
                <h4>Quick Links</h4>
                <ul>
                    <li><a href="index.html">Home</a></li>
                    <li><a href="eventspage.html">Events</a></li>
                    <li><a href="blog.html">Blog</a></li>
                    <li><a href="directories.html">Directories</a></li>
                </ul>
            </div>
            <div>
                <h4>Resources</h4>
                <ul>
                    <li><a href="tools.html">Financial Tools</a></li>
                    <li><a href="pitch.html">Pitch Competition</a></li>
                    <li><a href="profile.html">My Profile</a></li>
                    <li><a href="about.html">About Us</a></li>
                </ul>
            </div>
            <div>
                <h4>Contact</h4>
                <p>
                    <a href="contact.html">Contact Us</a><br>
                    <a href="faq.html">FAQ</a>
                </p>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2026 Enterprise Room Business Hub. All Rights Reserved.</p>
        </div>
    </div>
</footer>

</body>
</html>
