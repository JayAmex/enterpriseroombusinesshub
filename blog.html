<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Publications & Insights | Enterprise Room Business Hub</title>
    <link rel="icon" type="image/jpeg" href="assets/logo.jpg">
    <link rel="stylesheet" href="css/styles.css">
    <style>
        /* Page-specific styles */
        .container {
            max-width: 1800px;
            margin: 0 auto;
            padding: 20px 4%;
        }
        
        .filter-nav {
            display: flex;
            gap: 15px;
            margin-bottom: 40px;
            overflow-x: auto;
            padding-bottom: 10px;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 10px 20px;
            border: 1px solid var(--border);
            background: var(--white);
            border-radius: 25px;
            cursor: pointer;
            white-space: nowrap;
            font-weight: 500;
            transition: all 0.3s;
        }

        .filter-btn:hover {
            border-color: var(--accent);
            color: var(--accent);
        }

        .filter-btn.active {
            background: var(--primary);
            color: var(--white);
            border-color: var(--primary);
        }

        .section-title {
            margin-bottom: 30px;
            border-left: 5px solid var(--accent);
            padding-left: 15px;
        }

        .blog-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 20px;
            margin-bottom: 60px;
        }
        
        /* Responsive: 4 columns on large tablets, 3 on medium tablets, 2 on small tablets, 1 on mobile */
        @media (max-width: 1400px) {
            .blog-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }
        
        @media (max-width: 1024px) {
            .blog-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }
        
        @media (max-width: 768px) {
            .blog-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (max-width: 480px) {
            .blog-grid {
                grid-template-columns: 1fr;
            }
        }

        .card {
            display: flex;
            flex-direction: column;
            height: 100%;
            min-height: 360px;
        }

        .card-img {
            height: 100px;
            background: #cbd5e0;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--white);
            font-weight: bold;
            flex-shrink: 0;
        }
        
        /* Color schemes for different blog types */
        .card-img.news {
            background: var(--primary);
        }
        
        .card-img.strategy {
            background: var(--accent);
        }
        
        .card-img.research {
            background: #4a5568;
        }
        
        .card-img.case-study,
        .card-img.case-studies {
            background: var(--success);
        }
        
        .card-img.testimonials,
        .card-img.testimonial {
            background: var(--enterprise);
        }
        
        .card-img.article,
        .card-img.articles {
            background: #2b6cb0;
        }

        .card-content {
            padding: 14px;
            flex: 1;
            display: flex;
            flex-direction: column;
            min-height: 240px;
        }

        .tag {
            font-size: 0.7rem;
            text-transform: uppercase;
            color: var(--accent);
            font-weight: bold;
            margin-bottom: 8px;
            display: block;
            flex-shrink: 0;
        }

        .card h3 {
            margin: 0 0 8px 0;
            font-size: 0.95rem;
            color: var(--primary);
            line-height: 1.3;
            flex-shrink: 0;
            min-height: 2.6em;
            max-height: 3.9em;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }

        .card p {
            font-size: 0.75rem;
            color: var(--text-light);
            line-height: 1.5;
            margin: 0 0 8px 0;
            flex: 1;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
            min-height: 4.5em;
            max-height: 4.5em;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }
        
        .card-author {
            font-size: 0.7rem;
            color: var(--text-light);
            margin-top: auto;
            padding-top: 8px;
            font-style: italic;
            flex-shrink: 0;
        }

        .video-placeholder {
            background: #2d3748;
            width: 100%;
            height: 100%;
            position: relative;
        }

        .play-icon {
            font-size: 3rem;
            opacity: 0.8;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .header-center {
            text-align: center;
            margin-bottom: 50px;
        }
    </style>
</head>
<body>

<nav>
    <a href="index.html" class="logo">
        <img src="assets/logo.jpg" alt="Enterprise Room Business Hub Logo" style="height: 60px; max-width: 200px; width: auto; object-fit: contain;">
        <span>Enterprise Room Business Hub</span>
    </a>
    <ul>
        <li><a href="index.html">Home</a></li>
        <li><a href="eventspage.html">Events</a></li>
        <li><a href="blog.html">Blog</a></li>
        <li><a href="tools.html">Tools</a></li>
        <li><a href="pitch.html" class="btn-primary-link">Pitch Competition</a></li>
        <li><a href="directories.html" class="btn-primary-link">Directories</a></li>
        <li><a href="profile.html" class="btn-profile"><span class="nav-avatar-text">My Profile</span></a></li>
    </ul>
</nav>

<div class="breadcrumbs">
    <a href="index.html">Home</a>
    <span>/</span>
    <span>Blog</span>
</div>

<div class="container">
    <div class="header-center">
        <h1>Knowledge Hub</h1>
        <p>Insights, research, and success stories from our ecosystem.</p>
    </div>

    <!-- Search Bar -->
    <div style="margin-bottom: 30px; max-width: 600px; margin-left: auto; margin-right: auto;">
        <div style="position: relative;">
            <input type="text" id="blogSearch" placeholder="Search articles, authors, topics..." 
                   style="width: 100%; padding: 12px 45px 12px 15px; border: 2px solid var(--border); border-radius: 25px; font-size: 1rem; outline: none; transition: border-color 0.3s;"
                   onkeyup="handleBlogSearch(event)" oninput="handleBlogSearch(event)">
            <span style="position: absolute; right: 15px; top: 50%; transform: translateY(-50%); color: var(--text-light); font-size: 1.2rem;">üîç</span>
        </div>
        <div id="searchResults" style="display: none; margin-top: 10px; padding: 15px; background: var(--white); border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
            <div id="searchResultsContent"></div>
        </div>
    </div>

    <div class="filter-nav">
        <button class="filter-btn active" data-filter="all" onclick="filterByCategory('all', this)">All Publications</button>
        <button class="filter-btn" data-filter="articles" onclick="filterByCategory('articles', this)">Articles</button>
        <button class="filter-btn" data-filter="case-studies" onclick="filterByCategory('case-studies', this)">Case Studies</button>
        <button class="filter-btn" data-filter="research" onclick="filterByCategory('research', this)">Research Reports</button>
        <button class="filter-btn" data-filter="testimonials" onclick="filterByCategory('testimonials', this)">Testimonials</button>
    </div>

    <h2 class="section-title">Latest Articles & News</h2>
    <div id="articles-grid" class="blog-grid">
        <p style="text-align: center; color: var(--text-light);">Loading articles...</p>
    </div>

    <h2 class="section-title">Case Studies & Research</h2>
    <div id="case-studies-research-grid" class="blog-grid">
        <p style="text-align: center; color: var(--text-light);">Loading case studies and research...</p>
    </div>

    <h2 class="section-title">Testimonials</h2>
    <div id="testimonials-grid" class="blog-grid">
        <p style="text-align: center; color: var(--text-light);">Loading testimonials...</p>
    </div>

    <!-- Popular Posts Section -->
    <h2 class="section-title">Popular Posts</h2>
    <div id="popular-grid" class="blog-grid">
        <p style="text-align: center; color: var(--text-light);">Loading popular posts...</p>
    </div>

    <!-- Pagination -->
    <div id="pagination" style="display: none; margin-top: 40px; text-align: center;">
        <button id="prevPage" onclick="changePage(-1)" style="padding: 10px 20px; margin: 0 10px; background: var(--primary); color: var(--white); border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">‚Üê Previous</button>
        <span id="pageInfo" style="margin: 0 15px; color: var(--text); font-weight: 600;"></span>
        <button id="nextPage" onclick="changePage(1)" style="padding: 10px 20px; margin: 0 10px; background: var(--primary); color: var(--white); border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">Next ‚Üí</button>
    </div>
</div>

<script src="js/common.js"></script>
<script>
    let allBlogPosts = [];
    
    // Load all blog posts from API
    async function loadBlogPosts() {
        try {
            const response = await fetch('http://localhost:3000/api/blog?limit=100');
            if (!response.ok) throw new Error('Failed to load blog posts');
            
            const data = await response.json();
            allBlogPosts = data.posts || [];
            
            renderBlogPosts();
        } catch (error) {
            console.error('Error loading blog posts:', error);
            document.getElementById('articles-grid').innerHTML = '<p style="text-align: center; color: var(--text-light);">Unable to load blog posts.</p>';
        }
    }
    
    // Render blog posts by category
    function renderBlogPosts() {
        // Categorize posts
        const articles = allBlogPosts.filter(post => {
            const cat = (post.category || '').toLowerCase();
            return cat === 'articles' || cat === 'news' || cat === 'strategy' || cat === 'article';
        });
        const caseStudies = allBlogPosts.filter(post => {
            const cat = (post.category || '').toLowerCase();
            return cat === 'case studies' || cat === 'case-studies' || cat === 'case study';
        });
        const research = allBlogPosts.filter(post => {
            const cat = (post.category || '').toLowerCase();
            return cat === 'research' || cat === 'research reports' || cat.includes('research');
        });
        const testimonials = allBlogPosts.filter(post => {
            const cat = (post.category || '').toLowerCase();
            return cat === 'testimonials' || cat === 'testimonial';
        });
        
        // Render articles
        const articlesGrid = document.getElementById('articles-grid');
        if (articles.length > 0) {
            articlesGrid.innerHTML = articles.map(post => renderBlogCard(post, 'articles')).join('');
        } else {
            articlesGrid.innerHTML = '<p style="text-align: center; color: var(--text-light);">No articles available.</p>';
        }
        
        // Render case studies and research
        const caseStudiesResearchGrid = document.getElementById('case-studies-research-grid');
        const combined = [...caseStudies, ...research];
        if (combined.length > 0) {
            caseStudiesResearchGrid.innerHTML = combined.map(post => {
                const cat = (post.category || '').toLowerCase();
                const categoryType = (cat.includes('case') || cat.includes('case study')) ? 'case-studies' : 'research';
                return renderBlogCard(post, categoryType);
            }).join('');
        } else {
            caseStudiesResearchGrid.innerHTML = '<p style="text-align: center; color: var(--text-light);">No case studies or research available.</p>';
        }
        
        // Render testimonials
        const testimonialsGrid = document.getElementById('testimonials-grid');
        if (testimonials.length > 0) {
            testimonialsGrid.innerHTML = testimonials.map(post => renderBlogCard(post, 'testimonials')).join('');
        } else {
            testimonialsGrid.innerHTML = '<p style="text-align: center; color: var(--text-light);">No testimonials available.</p>';
        }
    }
    
    // Calculate reading time
    function calculateReadingTime(content) {
        const wordsPerMinute = 200;
        const text = content || '';
        const wordCount = text.split(/\s+/).filter(word => word.length > 0).length;
        const minutes = Math.ceil(wordCount / wordsPerMinute);
        return minutes || 1;
    }
    
    // Render a single blog card
    function renderBlogCard(post, categoryType) {
        const category = post.category || 'Uncategorized';
        const title = post.title || 'Untitled';
        const excerpt = post.excerpt || post.content || '';
        // Don't truncate in JavaScript - let CSS handle it with line-clamp
        const description = excerpt;
        const author = post.author || 'Anonymous';
        const publishedDate = post.published_date ? new Date(post.published_date).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' }) : '';
        const featuredImage = post.featured_image_url || '';
        const readingTime = calculateReadingTime(post.content || post.excerpt || '');
        const tags = post.tags ? post.tags.split(',').map(t => t.trim()).filter(t => t) : [];
        
        // Determine if it's a video testimonial (check if content mentions video or has video URL)
        const isVideoTestimonial = categoryType === 'testimonials' && (featuredImage.includes('youtube') || featuredImage.includes('vimeo') || post.content?.toLowerCase().includes('video'));
        
        // Determine color class based on category
        const categoryLower = (category || '').toLowerCase();
        let colorClass = 'articles'; // default
        if (categoryLower === 'news') {
            colorClass = 'news';
        } else if (categoryLower === 'strategy') {
            colorClass = 'strategy';
        } else if (categoryLower === 'research' || categoryLower === 'research reports') {
            colorClass = 'research';
        } else if (categoryLower.includes('case study') || categoryLower.includes('case-study')) {
            colorClass = 'case-study';
        } else if (categoryLower === 'testimonials' || categoryLower === 'testimonial') {
            colorClass = 'testimonials';
        } else if (categoryLower === 'articles' || categoryLower === 'article') {
            colorClass = 'articles';
        }
        
        let imageHTML = '';
        if (featuredImage) {
            imageHTML = `<div class="card-img ${colorClass}" style="background-image: url('${featuredImage}'); background-size: cover; background-position: center;">
                ${isVideoTestimonial ? '<div class="video-placeholder"><div class="play-icon">‚ñ∂</div></div>' : ''}
            </div>`;
        } else if (isVideoTestimonial) {
            imageHTML = `<div class="card-img ${colorClass}"><div class="video-placeholder"><div class="play-icon">‚ñ∂</div></div></div>`;
        } else {
            // Default placeholder with color scheme
            const placeholderText = categoryType === 'research' ? 'PDF Report' : categoryType === 'case-studies' ? 'Case Study Preview' : 'Article Preview';
            imageHTML = `<div class="card-img ${colorClass}">${placeholderText}</div>`;
        }
        
        const tagText = categoryType === 'testimonials' 
            ? (isVideoTestimonial ? 'Video Testimonial' : 'Written Testimonial')
            : category;
        
        // Escape HTML for title and description
        const safeTitle = title
            .replace(/&/g, '&amp;')
            .replace(/</g, '&lt;')
            .replace(/>/g, '&gt;')
            .replace(/"/g, '&quot;')
            .replace(/'/g, '&#39;');
        const safeDescription = description
            .replace(/&/g, '&amp;')
            .replace(/</g, '&lt;')
            .replace(/>/g, '&gt;')
            .replace(/"/g, '&quot;')
            .replace(/'/g, '&#39;');
        const safeAuthor = author
            .replace(/&/g, '&amp;')
            .replace(/</g, '&lt;')
            .replace(/>/g, '&gt;');
        
        const isAuthenticated = sessionStorage.getItem('userAuthenticated') === 'true' || sessionStorage.getItem('userToken') !== null;
        const bookmarkButton = isAuthenticated ? `
            <button onclick="event.stopPropagation(); toggleBookmark(${post.id}, event)" 
                    class="bookmark-btn" 
                    id="bookmark-${post.id}" 
                    title="Save for later"
                    style="position: absolute; top: 10px; right: 10px; background: rgba(255,255,255,0.9); border: none; border-radius: 50%; width: 35px; height: 35px; cursor: pointer; font-size: 1.2rem; display: flex; align-items: center; justify-content: center; box-shadow: 0 2px 4px rgba(0,0,0,0.2); z-index: 10;">
                <span id="bookmark-icon-${post.id}">üîñ</span>
            </button>
        ` : '';
        
        const tagsHTML = tags.length > 0 ? `
            <div style="display: flex; flex-wrap: wrap; gap: 5px; margin-top: 8px;">
                ${tags.slice(0, 3).map(tag => {
                    const safeTag = tag.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
                    return `<span style="font-size: 0.65rem; padding: 3px 8px; background: var(--light); color: var(--accent); border-radius: 12px; font-weight: 500;">#${safeTag}</span>`;
                }).join('')}
            </div>
        ` : '';
        
        return `
            <div class="card" data-category="${categoryType}" onclick="viewBlogPost(${post.id})" style="cursor: pointer; transition: transform 0.2s, box-shadow 0.2s; position: relative;" onmouseover="this.style.transform='translateY(-5px)'; this.style.boxShadow='0 4px 12px rgba(0,0,0,0.15)';" onmouseout="this.style.transform=''; this.style.boxShadow='';">
                ${bookmarkButton}
                ${imageHTML}
                <div class="card-content">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 6px;">
                        <span class="tag">${tagText}</span>
                        <span style="font-size: 0.7rem; color: var(--text-light);">‚è± ${readingTime} min read</span>
                    </div>
                    <h3>${safeTitle}</h3>
                    <p style="margin-bottom: ${tags.length > 0 ? '8px' : '0'}; flex: 1;">${safeDescription}</p>
                    ${tagsHTML}
                    ${author ? `<p class="card-author">By <a href="author.html?name=${encodeURIComponent(author)}" onclick="event.stopPropagation();" style="color: var(--accent); text-decoration: none;">${safeAuthor}</a>${publishedDate ? ` ‚Ä¢ ${publishedDate}` : ''}</p>` : ''}
                </div>
            </div>
        `;
    }
    
    function filterByCategory(category, buttonElement) {
        // Remove active class from all filter buttons
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.classList.remove('active');
        });
        
        // Add active class to clicked button
        buttonElement.classList.add('active');
        
        // Get all cards
        const cards = document.querySelectorAll('.card');
        const sections = document.querySelectorAll('.section-title');
        
        cards.forEach(card => {
            if (category === 'all') {
                // Show all cards
                card.style.display = '';
            } else {
                // Check if card matches the selected category
                const cardCategory = card.getAttribute('data-category');
                if (cardCategory === category) {
                    card.style.display = '';
                } else {
                    card.style.display = 'none';
                }
            }
        });
        
        // Hide/show section titles based on visible content
        sections.forEach(section => {
            const sectionGrid = section.nextElementSibling;
            if (sectionGrid && sectionGrid.classList.contains('blog-grid')) {
                const visibleCards = Array.from(sectionGrid.querySelectorAll('.card')).filter(card => 
                    card.style.display !== 'none'
                );
                if (visibleCards.length === 0 && category !== 'all') {
                    section.style.display = 'none';
                    sectionGrid.style.display = 'none';
                } else {
                    section.style.display = '';
                    sectionGrid.style.display = '';
                }
            }
        });
    }
    
    // View blog post in detail
    function viewBlogPost(postId) {
        window.location.href = `blog-post.html?id=${postId}`;
    }
    
    // Load popular posts
    async function loadPopularPosts() {
        try {
            const response = await fetch('http://localhost:3000/api/blog/popular?limit=5');
            if (!response.ok) throw new Error('Failed to load popular posts');
            
            const data = await response.json();
            const popularGrid = document.getElementById('popular-grid');
            
            if (data.posts && data.posts.length > 0) {
                popularGrid.innerHTML = data.posts.map(post => {
                    const cat = (post.category || '').toLowerCase();
                    const categoryType = cat.includes('case') ? 'case-studies' : 
                                       (cat === 'research' || cat === 'research reports') ? 'research' :
                                       (cat === 'testimonials' || cat === 'testimonial') ? 'testimonials' : 'articles';
                    return renderBlogCard(post, categoryType);
                }).join('');
                
                // Check bookmarks for popular posts
                if (sessionStorage.getItem('userAuthenticated') === 'true' || sessionStorage.getItem('userToken')) {
                    data.posts.forEach(post => checkBookmarkStatus(post.id));
                }
            } else {
                popularGrid.innerHTML = '<p style="text-align: center; color: var(--text-light);">No popular posts yet.</p>';
            }
        } catch (error) {
            console.error('Error loading popular posts:', error);
            document.getElementById('popular-grid').innerHTML = '<p style="text-align: center; color: var(--text-light);">Unable to load popular posts.</p>';
        }
    }
    
    // Search functionality
    let searchTimeout;
    async function handleBlogSearch(event) {
        const searchTerm = event.target.value.trim();
        const searchResults = document.getElementById('searchResults');
        const searchResultsContent = document.getElementById('searchResultsContent');
        
        clearTimeout(searchTimeout);
        
        if (searchTerm.length < 2) {
            searchResults.style.display = 'none';
            return;
        }
        
        searchTimeout = setTimeout(async () => {
            try {
                const response = await fetch(`http://localhost:3000/api/blog/search?q=${encodeURIComponent(searchTerm)}&limit=10`);
                if (!response.ok) throw new Error('Search failed');
                
                const data = await response.json();
                
                if (data.posts && data.posts.length > 0) {
                    searchResultsContent.innerHTML = `
                        <div style="margin-bottom: 10px; font-weight: 600; color: var(--primary);">Found ${data.posts.length} result(s)</div>
                        <div style="display: flex; flex-direction: column; gap: 10px;">
                            ${data.posts.map(post => {
                                const safeTitle = (post.title || 'Untitled').replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
                                const safeExcerpt = ((post.excerpt || post.content || '').substring(0, 100) + '...').replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
                                return `
                                    <div onclick="viewBlogPost(${post.id})" style="padding: 12px; border: 1px solid var(--border); border-radius: 8px; cursor: pointer; transition: background 0.2s;" 
                                         onmouseover="this.style.background='var(--light)';" onmouseout="this.style.background='';">
                                        <div style="font-weight: 600; color: var(--primary); margin-bottom: 5px;">${safeTitle}</div>
                                        <div style="font-size: 0.85rem; color: var(--text-light);">${safeExcerpt}</div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    `;
                    searchResults.style.display = 'block';
                } else {
                    searchResultsContent.innerHTML = '<p style="text-align: center; color: var(--text-light);">No results found.</p>';
                    searchResults.style.display = 'block';
                }
            } catch (error) {
                console.error('Search error:', error);
                searchResultsContent.innerHTML = '<p style="text-align: center; color: var(--live);">Search failed. Please try again.</p>';
                searchResults.style.display = 'block';
            }
        }, 300);
    }
    
    // Bookmark functionality
    async function toggleBookmark(postId, event) {
        const isAuthenticated = sessionStorage.getItem('userAuthenticated') === 'true' || sessionStorage.getItem('userToken');
        if (!isAuthenticated) {
            alert('Please log in to save posts.');
            return;
        }
        
        const token = sessionStorage.getItem('userToken');
        const icon = document.getElementById(`bookmark-icon-${postId}`);
        const btn = document.getElementById(`bookmark-${postId}`);
        
        try {
            // Check if already saved
            const checkResponse = await fetch(`http://localhost:3000/api/blog/${postId}/saved`, {
                headers: {
                    'Authorization': `Bearer ${token}`
                }
            });
            
            if (!checkResponse.ok) throw new Error('Failed to check bookmark status');
            const { saved } = await checkResponse.json();
            
            if (saved) {
                // Unsave
                const response = await fetch(`http://localhost:3000/api/blog/${postId}/save`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                if (response.ok) {
                    icon.textContent = 'üîñ';
                    btn.style.background = 'rgba(255,255,255,0.9)';
                }
            } else {
                // Save
                const response = await fetch(`http://localhost:3000/api/blog/${postId}/save`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                if (response.ok) {
                    icon.textContent = 'üîñ';
                    icon.style.color = 'var(--accent)';
                    btn.style.background = 'var(--accent)';
                    btn.style.color = 'var(--white)';
                }
            }
        } catch (error) {
            console.error('Bookmark error:', error);
            alert('Failed to save post. Please try again.');
        }
    }
    
    async function checkBookmarkStatus(postId) {
        const token = sessionStorage.getItem('userToken');
        if (!token) return;
        
        try {
            const response = await fetch(`http://localhost:3000/api/blog/${postId}/saved`, {
                headers: {
                    'Authorization': `Bearer ${token}`
                }
            });
            
            if (response.ok) {
                const { saved } = await response.json();
                const icon = document.getElementById(`bookmark-icon-${postId}`);
                const btn = document.getElementById(`bookmark-${postId}`);
                if (icon && btn && saved) {
                    icon.textContent = 'üîñ';
                    icon.style.color = 'var(--accent)';
                    btn.style.background = 'var(--accent)';
                    btn.style.color = 'var(--white)';
                }
            }
        } catch (error) {
            // Silently fail
        }
    }
    
    // Pagination
    let currentPage = 1;
    const postsPerPage = 20;
    
    async function changePage(direction) {
        currentPage += direction;
        if (currentPage < 1) currentPage = 1;
        
        try {
            const response = await fetch(`http://localhost:3000/api/blog?page=${currentPage}&limit=${postsPerPage}`);
            if (!response.ok) throw new Error('Failed to load posts');
            
            const data = await response.json();
            allBlogPosts = data.posts || [];
            renderBlogPosts();
            
            // Update pagination UI
            const pageInfo = document.getElementById('pageInfo');
            const pagination = document.getElementById('pagination');
            const prevBtn = document.getElementById('prevPage');
            const nextBtn = document.getElementById('nextPage');
            
            if (data.pagination) {
                pageInfo.textContent = `Page ${data.pagination.page} of ${data.pagination.pages}`;
                prevBtn.disabled = !data.pagination.has_prev;
                nextBtn.disabled = !data.pagination.has_next;
                pagination.style.display = data.pagination.pages > 1 ? 'block' : 'none';
            }
        } catch (error) {
            console.error('Pagination error:', error);
        }
    }
    
    // Load blog posts on page load
    window.addEventListener('DOMContentLoaded', function() {
        loadBlogPosts();
        loadPopularPosts();
        updateNavAuthStatus();
        loadNavAvatar();
    });
    
</script>

<footer>
    <div class="container">
        <div class="footer-grid">
            <div>
                <h3>Enterprise Room Business Hub</h3>
                <p>Empowering entrepreneurs with resources, networks, and tools to scale and succeed.</p>
            </div>
            <div>
                <h4>Quick Links</h4>
                <ul>
                    <li><a href="index.html">Home</a></li>
                    <li><a href="eventspage.html">Events</a></li>
                    <li><a href="blog.html">Blog</a></li>
                    <li><a href="directories.html">Directories</a></li>
                </ul>
            </div>
            <div>
                <h4>Resources</h4>
                <ul>
                    <li><a href="tools.html">Financial Tools</a></li>
                    <li><a href="pitch.html">Pitch Competition</a></li>
                    <li><a href="profile.html">My Profile</a></li>
                    <li><a href="about.html">About Us</a></li>
                </ul>
            </div>
            <div>
                <h4>Contact</h4>
                <p>
                    <a href="contact.html">Contact Us</a><br>
                    <a href="faq.html">FAQ</a>
                </p>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2026 Enterprise Room Business Hub. All Rights Reserved.</p>
        </div>
    </div>
</footer>

</body>
</html>
